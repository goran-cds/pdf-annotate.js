{"version":3,"sources":["webpack://PDFAnnotate/webpack/universalModuleDefinition","webpack://PDFAnnotate/webpack/bootstrap","webpack://PDFAnnotate/./node_modules/events/events.js","webpack://PDFAnnotate/./src/utils/abstractFunction.js","webpack://PDFAnnotate/./src/utils/setAttributes.js","webpack://PDFAnnotate/./src/utils/normalizeColor.js","webpack://PDFAnnotate/./src/render/renderPoint.js","webpack://PDFAnnotate/./src/render/renderRect.js","webpack://PDFAnnotate/./src/render/renderStamp.js","webpack://PDFAnnotate/./src/render/renderText.js","webpack://PDFAnnotate/./src/render/renderSignatureBlock.js","webpack://PDFAnnotate/./src/utils/mathUtils.js","webpack://PDFAnnotate/./src/render/renderArrow.js","webpack://PDFAnnotate/./src/render/appendChild.js","webpack://PDFAnnotate/./src/render/renderLine.js","webpack://PDFAnnotate/./src/render/renderPath.js","webpack://PDFAnnotate/./src/UI/utils.js","webpack://PDFAnnotate/./src/UI/event.js","webpack://PDFAnnotate/./src/adapter/StoreAdapter.js","webpack://PDFAnnotate/./src/utils/uuid.js","webpack://PDFAnnotate/./src/adapter/LocalStoreAdapter.js","webpack://PDFAnnotate/./src/adapter/LocalUserStoreAdapter.js","webpack://PDFAnnotate/./src/config.js","webpack://PDFAnnotate/./src/UI/edit.js","webpack://PDFAnnotate/./src/UI/pen.js","webpack://PDFAnnotate/./src/UI/arrow.js","webpack://PDFAnnotate/./src/UI/eraser.js","webpack://PDFAnnotate/./src/UI/point.js","webpack://PDFAnnotate/./src/UI/rect.js","webpack://PDFAnnotate/./src/UI/signatureBlock.js","webpack://PDFAnnotate/./src/UI/text.js","webpack://PDFAnnotate/./src/a11y/createScreenReaderOnly.js","webpack://PDFAnnotate/./src/a11y/insertElementWithinElement.js","webpack://PDFAnnotate/./src/a11y/insertElementWithinChildren.js","webpack://PDFAnnotate/./src/a11y/insertScreenReaderComment.js","webpack://PDFAnnotate/./src/a11y/renderScreenReaderComments.js","webpack://PDFAnnotate/./src/a11y/insertScreenReaderHint.js","webpack://PDFAnnotate/./src/a11y/initEventHandlers.js","webpack://PDFAnnotate/./src/a11y/renderScreenReaderHints.js","webpack://PDFAnnotate/./src/UI/page.js","webpack://PDFAnnotate/./src/UI/index.js","webpack://PDFAnnotate/./src/PDFJSAnnotate.js","webpack://PDFAnnotate/./src/render/index.js","webpack://PDFAnnotate/./index.js"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","ReflectOwnKeys","R","Reflect","ReflectApply","apply","target","receiver","args","Function","ownKeys","getOwnPropertySymbols","getOwnPropertyNames","concat","NumberIsNaN","Number","isNaN","EventEmitter","init","this","once","emitter","Promise","resolve","reject","errorListener","err","removeListener","resolver","slice","arguments","eventTargetAgnosticAddListener","handler","flags","on","addErrorHandlerIfEventEmitter","_events","undefined","_eventsCount","_maxListeners","defaultMaxListeners","checkListener","listener","TypeError","_getMaxListeners","that","_addListener","type","prepend","events","existing","warning","newListener","emit","unshift","push","length","warned","w","Error","String","count","console","warn","onceWrapper","fired","wrapFn","_onceWrap","state","wrapped","_listeners","unwrap","evlistener","arr","ret","Array","unwrapListeners","arrayClone","listenerCount","copy","addEventListener","wrapListener","arg","removeEventListener","set","RangeError","getPrototypeOf","setMaxListeners","getMaxListeners","doError","error","er","message","context","len","listeners","addListener","prependListener","prependOnceListener","list","position","originalListener","shift","index","pop","spliceOne","off","removeAllListeners","keys","rawListeners","eventNames","abstractFunction","UPPER_REGEX","BLACKLIST","setAttributes","node","attributes","forEach","setAttribute","indexOf","replace","match","toLowerCase","keyCase","REGEX_HASHLESS_HEX","normalizeColor","color","test","SIZE","createRect","rect","document","createElementNS","x","y","width","height","renderStamp","a","rectangles","fill","stroke","renderText","text","fontSize","size","transform","rotation","style","textElement","textContent","_step","lines","split","getAttribute","_iterator","_createForOfIteratorHelper","done","line","tspan","toString","innerHTML","appendChild","e","f","insertLineBreaks","content","g","renderSignatureBlock","signatureBlock","group","cx","cy","penIcon","viewBox","xmlns","penPath","createSignatureBlock","translate","rotate","angle","Math","PI","cosValue","cos","sinValue","sin","scale","makePoint","z","makeVector","xcoord","ycoord","zcoord","makeVectorFromPoints","pt1","pt2","addVector","pt","v","multiplyVector","scalar","magnitude","sqrt","pow","negateVector","unitVector","mag","renderArrow","u","arrow","p1","p2","pt0","unitX","unitZ","unitY","thickness","A","B","C","D","G","F","E","points","isFirefox","navigator","userAgent","getTranslation","viewport","trans","nodeName","parseInt","path","querySelector","svg","parentNode","assign","annotation","child","JSON","parse","fillOpacity","renderRect","strokeWidth","x1","y1","x2","y2","outerSVG","innerSVG","renderPoint","join","renderPath","uuid","filter","transformChild","BORDER_COLOR","userSelectStyleSheet","createElement","findSVGContainer","toUpperCase","findSVGAtPoint","elements","querySelectorAll","el","pointIntersectsRect","getBoundingClientRect","findAnnotationAtPoint","candidate","elementFromPoint","top","bottom","left","right","getOffsetAnnotationRect","extraOffsetWidth","extraOffsetHeight","tagName","getBBox","bbox","_getOffset","offsetLeft","offsetTop","getOffset","scaleUp","result","getMetadata","convertToSvgPoint","xform","offset","convertToScreenPoint","scaleDown","disableUserSelect","head","enableUserSelect","removeChild","documentId","pageNumber","clickNode","fireEvent","clientX","clientY","StoreAdapter","_this","definition","_classCallCheck","__getAnnotations","fn","then","annotations","annotationId","__addAnnotation","__editAnnotation","__deleteAnnotation","success","__addComment","comment","commentId","__deleteComment","REGEXP","replacement","random","LocalStoreAdapter","_StoreAdapter","_callSuper","getAnnotations","page","getAnnotation","findAnnotation","addAnnotation","updateAnnotations","editAnnotation","deleteAnnotation","splice","getComments","addComment","class","deleteComment","_inherits","localStorage","getItem","setItem","stringify","LocalUserStoreAdapter","userId","globalEdit","getAllAnnotations","_userId","_globalEdit","all_annotations","re","RegExp","search","_toConsumableArray","annotationLayerName","textLayerName","annotationSvgQuery","annotationClassQuery","textClassQuery","overlay","dragOffsetX","dragOffsetY","dragStartX","dragStartY","_enabled","isDragging","destroyEditOverlay","handleDocumentClick","handleDocumentKeyup","handleDocumentMousedown","handleDocumentMousemove","handleDocumentMouseup","config","PDFJSAnnotate","getStoreAdapter","getElementById","keyTest","keyCode","preventDefault","background","cursor","display","maxY","maxX","offsetHeight","offsetWidth","attribX","attribY","modelStart","modelEnd","modelDelta","firstChild","modelX","modelY","setTimeout","handleAnnotationClick","anchor","id","styleLeft","styleTop","boxSizing","border","borderRadius","zIndex","padding","textAlign","textDecoration","borderColor","boxShadow","createEditOverlay","_penSize","_penColor","_candraw","handleDocumentPointerdown","handleDocumentPointerup","_getMetadata","saveToStorage","handleDocumentPointermove","point","toFixed","savePoint","originY","originX","_getMetadata2","_canerase","previousPoint","handleDocumentDown","handleDocumentUp","erase","handleDocumentMouseMove","check","diffX","abs","diffY","maxSteps","round","max","subStepSize","min","smallerTest","startPoint","_i","_check","parentElement","input","handleInputBlur","handleInputKeyup","body","focus","closeInput","trim","_type","rects","getSelection","getRangeAt","getClientRects","getSelectionRects","saveRect","map","removeAllRanges","boundingRect","convertToSvgRect","_width","_color","svg_pt","h","event","CustomEvent","detail","dispatchEvent","saveSignatureBlock","_textSize","_textColor","srcElement","classList","contains","saveText","shiftKey","createScreenReaderOnly","createTextNode","overflow","insertElementWithinElement","insertBefore","textLayerElementFromPoint","temp","cloneNode","tail","outerHTML","insertElementWithinChildren","nodes","textLayer","insertScreenReaderComment","item","renderScreenReaderComments","comments","isArray","COMMENT_TYPES","reorderAnnotationsByType","removeAnnotation","renderScreenReaderHints","removeElementById","insertComment","removeComment","elementId","SORT_TYPES","sortBy","sort","num","first","last","includes","insertScreenReaderHint","sortByPoint","b","sortByRectPoint","lineA","lineB","PAGE_TEMPLATE","approximateFraction","floor","xinv","x_","q","roundToDivide","div","disableEdit","enableEdit","disablePen","enablePen","setPen","penSize","penColor","parseFloat","disablePoint","enablePoint","disableRect","enableRect","disableSignatureBlock","enableSignatureBlock","setSignatureBlock","addSignatureBlock","oldType","disableArrow","enableArrow","setArrow","disableEraser","enableEraser","disableText","enableText","setText","textColor","createPage","children","canvas","mozOpaque","renderPage","renderOptions","pdfDocument","pdfjsViewer","EventBus","all","getPage","_ref","_ref2","_slicedToArray","pdfPage","canvasContext","getContext","alpha","totalRotation","getViewport","wrapper","outputScale","ctx","devicePixelRatio","backingStoreRatio","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio","pixelRatio","sx","sy","scaled","sfx","sfy","visibility","scalePage","render","promise","getTextContent","normalizeWhitespace","__storeAdapter","setStoreAdapter","adapter","UI","data","removeAttribute","_this$getStoreAdapter"],"mappings":"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","file":"pdf-annotate.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"PDFAnnotate\"] = factory();\n\telse\n\t\troot[\"PDFAnnotate\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\nmodule.exports.once = once;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n\nfunction once(emitter, name) {\n  return new Promise(function (resolve, reject) {\n    function errorListener(err) {\n      emitter.removeListener(name, resolver);\n      reject(err);\n    }\n\n    function resolver() {\n      if (typeof emitter.removeListener === 'function') {\n        emitter.removeListener('error', errorListener);\n      }\n      resolve([].slice.call(arguments));\n    };\n\n    eventTargetAgnosticAddListener(emitter, name, resolver, { once: true });\n    if (name !== 'error') {\n      addErrorHandlerIfEventEmitter(emitter, errorListener, { once: true });\n    }\n  });\n}\n\nfunction addErrorHandlerIfEventEmitter(emitter, handler, flags) {\n  if (typeof emitter.on === 'function') {\n    eventTargetAgnosticAddListener(emitter, 'error', handler, flags);\n  }\n}\n\nfunction eventTargetAgnosticAddListener(emitter, name, listener, flags) {\n  if (typeof emitter.on === 'function') {\n    if (flags.once) {\n      emitter.once(name, listener);\n    } else {\n      emitter.on(name, listener);\n    }\n  } else if (typeof emitter.addEventListener === 'function') {\n    // EventTarget does not have `error` event semantics like Node\n    // EventEmitters, we do not listen for `error` events here.\n    emitter.addEventListener(name, function wrapListener(arg) {\n      // IE does not have builtin `{ once: true }` support so we\n      // have to do it manually.\n      if (flags.once) {\n        emitter.removeEventListener(name, wrapListener);\n      }\n      listener(arg);\n    });\n  } else {\n    throw new TypeError('The \"emitter\" argument must be of type EventEmitter. Received type ' + typeof emitter);\n  }\n}\n","/**\n * Throw an Error for an abstract function that hasn't been implemented.\n *\n * @param {String} name The name of the abstract function\n */\nexport default function abstractFunction(name) {\n  throw new Error(name + ' is not implemented');\n}\n","const UPPER_REGEX = /[A-Z]/g;\n\n// Don't convert these attributes from camelCase to hyphenated-attributes\nconst BLACKLIST = [\n  'viewBox'\n];\n\nlet keyCase = (key) => {\n  if (BLACKLIST.indexOf(key) === -1) {\n    key = key.replace(UPPER_REGEX, match => '-' + match.toLowerCase());\n  }\n  return key;\n};\n\n/**\n * Set attributes for a node from a map\n *\n * @param {Node} node The node to set attributes on\n * @param {Object} attributes The map of key/value pairs to use for attributes\n */\nexport default function setAttributes(node, attributes) {\n  Object.keys(attributes).forEach((key) => {\n    node.setAttribute(keyCase(key), attributes[key]);\n  });\n}\n","const REGEX_HASHLESS_HEX = /^([a-f0-9]{6}|[a-f0-9]{3})$/i;\n\n/**\n * Normalize a color value\n *\n * @param {String} color The color to normalize\n * @return {String}\n */\nexport default function normalizeColor(color) {\n  if (REGEX_HASHLESS_HEX.test(color)) {\n    color = `#${color}`;\n  }\n  return color;\n}\n","import setAttributes from '../utils/setAttributes';\n\nconst SIZE = 25;\nconst D = 'M499.968 214.336q-113.832 0 -212.877 38.781t-157.356 104.625 -58.311 142.29q0 62.496 39.897 119.133t112.437 97.929l48.546 27.9 -15.066 53.568q-13.392 50.778 -39.06 95.976 84.816 -35.154 153.45 -95.418l23.994 -21.204 31.806 3.348q38.502 4.464 72.54 4.464 113.832 0 212.877 -38.781t157.356 -104.625 58.311 -142.29 -58.311 -142.29 -157.356 -104.625 -212.877 -38.781z';\n\n/**\n * Create SVGElement from an annotation definition.\n * This is used for anntations of type `comment`.\n *\n * @param {Object} a The annotation definition\n * @return {SVGElement} A svg to be rendered\n */\nexport default function renderPoint(a) {\n  let outerSVG = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n  let innerSVG = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n  let rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n  let path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n\n  setAttributes(outerSVG, {\n    width: SIZE,\n    height: SIZE,\n    x: a.x,\n    y: a.y\n  });\n\n  setAttributes(innerSVG, {\n    width: SIZE,\n    height: SIZE,\n    x: 0,\n    y: (SIZE * 0.05) * -1,\n    viewBox: '0 0 1000 1000'\n  });\n\n  setAttributes(rect, {\n    width: SIZE,\n    height: SIZE,\n    stroke: '#000',\n    fill: '#ff0'\n  });\n\n  setAttributes(path, {\n    d: D,\n    strokeWidth: 50,\n    stroke: '#000',\n    fill: '#fff'\n  });\n\n  innerSVG.appendChild(path);\n  outerSVG.appendChild(rect);\n  outerSVG.appendChild(innerSVG);\n\n  return outerSVG;\n}\n","import setAttributes from '../utils/setAttributes';\nimport normalizeColor from '../utils/normalizeColor';\n\n/**\n * Create SVGRectElements from an annotation definition.\n * This is used for anntations of type `area` and `highlight`.\n *\n * @param {Object} a The annotation definition\n * @return {SVGGElement|SVGRectElement} A group of all rects to be rendered\n */\nexport default function renderRect(a) {\n  if (a.type === 'highlight') {\n    let group = document.createElementNS('http://www.w3.org/2000/svg', 'g');\n    setAttributes(group, {\n      fill: normalizeColor(a.color || '#ff0'),\n      fillOpacity: 0.2\n    });\n\n    a.rectangles.forEach((r) => {\n      group.appendChild(createRect(r));\n    });\n\n    return group;\n  }\n  else {\n    let rect = createRect(a);\n    setAttributes(rect, {\n      stroke: normalizeColor(a.color || '#f00'),\n      fill: 'none'\n    });\n\n    return rect;\n  }\n}\n\nfunction createRect(r) {\n  let rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n\n  setAttributes(rect, {\n    x: r.x,\n    y: r.y,\n    width: r.width,\n    height: r.height\n  });\n\n  return rect;\n}\n","import setAttributes from \"../utils/setAttributes\";\nimport normalizeColor from \"../utils/normalizeColor\";\n/**\n * Create an SVGRectElement from an annotation definition.\n * This is used for annotations of type `stamp`.\n *\n * @param {Object} a The annotation definition\n * @return {SVGRectElement} A rectangle to be rendered\n */\nexport default function renderStamp(a) {\n  let rect = createRect(a);\n  let color = normalizeColor(a.color || \"#FFFF00\"); // Default color for stamp\n\n  setAttributes(rect, {\n    fill: color,\n    stroke: color,\n    \"stroke-width\": 1, // Optional: a border stroke width\n  });\n\n  return rect;\n}\n\n/**\n * Create an SVGRectElement with the given attributes.\n *\n * @param {Object} a The annotation definition\n * @return {SVGRectElement} A rectangle element\n */\nfunction createRect(a) {\n  let rect = document.createElementNS(\"http://www.w3.org/2000/svg\", \"rect\");\n  setAttributes(rect, {\n    x: a.rectangles[0].x,\n    y: a.rectangles[0].y,\n    width: a.rectangles[0].width,\n    height: a.rectangles[0].height,\n  });\n\n  return rect;\n}\n","import setAttributes from '../utils/setAttributes';\nimport normalizeColor from '../utils/normalizeColor';\n\n/**\n * Wrap each line of given text in a `<tspan>` element and append these\n * lines to the given SVGTextElement\n *\n * @param {SVGTextElement} textElement A text element to hold the split text\n * @param {String} textContent String to render with line breaks\n */\nfunction insertLineBreaks(textElement, textContent) {\n  const lines = (textContent || '').split('\\n');\n  // can't use dy attribute here since we want empty lines to take up space as well,\n  // so we will update y manually based on font size\n  const x = textElement.getAttribute('x');\n  let y = Number(textElement.getAttribute('y'));\n  const size = Number(textElement.getAttribute('font-size'));\n  for (const line of lines) {\n    const tspan = document.createElementNS('http://www.w3.org/2000/svg', 'tspan');\n    tspan.setAttribute('y', y.toString());\n    tspan.setAttribute('x', x);\n    tspan.innerHTML = line;\n    textElement.appendChild(tspan);\n\n    y += size;\n  }\n}\n\n/**\n * Create SVGTextElement from an annotation definition.\n * This is used for anntations of type `textbox`.\n *\n * @param {Object} a The annotation definition\n * @return {SVGTextElement} A text to be rendered\n */\nexport default function renderText(a) {\n  // Text should be rendered at 0 degrees relative to\n  // document rotation\n  let text = document.createElementNS('http://www.w3.org/2000/svg', 'text');\n  setAttributes(text, {\n    x: a.x,\n    y: a.y,\n    fill: normalizeColor(a.color || '#000'),\n    fontSize: a.size,\n    transform: `rotate(${a.rotation})`,\n    style: 'white-space: pre'\n  });\n\n  insertLineBreaks(text, a.content);\n\n  let g = document.createElementNS('http://www.w3.org/2000/svg', 'g');\n  g.appendChild(text);\n\n  return g;\n}\n","import setAttributes from \"../utils/setAttributes\";\nimport normalizeColor from \"../utils/normalizeColor\";\n\nlet index = 1;\n\n/**\n * Create a custom signature block component from an annotation definition.\n * This is used for annotations of type `signature`.\n *\n * @param {Object} a The annotation definition\n * @return {SVGGElement} A svg to be rendered\n */\nexport default function renderSignatureBlock(a) {\n  let signatureBlock = createSignatureBlock(a);\n\n  return signatureBlock;\n}\n\nfunction createSignatureBlock(a) {\n  let group = document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\");\n\n  let rect = document.createElementNS(\"http://www.w3.org/2000/svg\", \"rect\");\n  setAttributes(rect, {\n    x: a.cx - 50,\n    y: a.cy - 15,\n    width: 100,\n    height: 30,\n    fill: \"#f9fac3\",\n  });\n\n  // Append the shape to the group\n  group.appendChild(rect);\n\n  // Inline SVG for the pen icon\n  let penIcon = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n  setAttributes(penIcon, {\n    x: a.cx - 40,\n    y: a.cy - 6,\n    width: 12,\n    height: 12,\n    viewBox: \"0 0 24 24\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n  });\n  let penPath = document.createElementNS(\"http://www.w3.org/2000/svg\", \"path\");\n  setAttributes(penPath, {\n    d: \"M15.4998 5.50067L18.3282 8.3291M13 21H21M3 21.0004L3.04745 20.6683C3.21536 19.4929 3.29932 18.9052 3.49029 18.3565C3.65975 17.8697 3.89124 17.4067 4.17906 16.979C4.50341 16.497 4.92319 16.0772 5.76274 15.2377L17.4107 3.58969C18.1918 2.80865 19.4581 2.80864 20.2392 3.58969C21.0202 4.37074 21.0202 5.63707 20.2392 6.41812L8.37744 18.2798C7.61579 19.0415 7.23497 19.4223 6.8012 19.7252C6.41618 19.994 6.00093 20.2167 5.56398 20.3887C5.07171 20.5824 4.54375 20.6889 3.48793 20.902L3 21.0004Z\",\n    stroke: \"#545225\",\n    \"stroke-width\": \"2\",\n    \"stroke-linecap\": \"round\",\n    \"stroke-linejoin\": \"round\",\n  });\n  penIcon.appendChild(penPath);\n  group.appendChild(penIcon);\n\n  // Text element\n  let text = document.createElementNS(\"http://www.w3.org/2000/svg\", \"text\");\n  setAttributes(text, {\n    x: a.cx + 5,\n    y: a.cy + 1,\n    \"font-size\": 8,\n    \"text-anchor\": \"middle\",\n    \"dominant-baseline\": \"middle\",\n    fill: \"#545225\",\n  });\n  text.textContent = `Signature area ${index}`;\n\n  group.appendChild(text);\n\n  index = index + 1;\n\n  return group;\n}\n","// Transform point by matrix\n//\nexport function applyTransform(p, m) {\n  return [\n    p[0] * m[0] + p[1] * m[2] + m[4],\n    p[0] * m[1] + p[1] * m[3] + m[5]\n  ];\n};\n\n// Transform point by matrix inverse\n//\nexport function applyInverseTransform(p, m) {\n  let d = m[0] * m[3] - m[1] * m[2];\n  return [\n    (p[0] * m[3] - p[1] * m[2] + m[2] * m[5] - m[4] * m[3]) / d,\n    (-p[0] * m[1] + p[1] * m[0] + m[4] * m[1] - m[5] * m[0]) / d\n  ];\n};\n\n// Concatenates two transformation matrices together and returns the result.\nexport function transform(m1, m2) {\n  return [\n    m1[0] * m2[0] + m1[2] * m2[1],\n    m1[1] * m2[0] + m1[3] * m2[1],\n    m1[0] * m2[2] + m1[2] * m2[3],\n    m1[1] * m2[2] + m1[3] * m2[3],\n    m1[0] * m2[4] + m1[2] * m2[5] + m1[4],\n    m1[1] * m2[4] + m1[3] * m2[5] + m1[5]\n  ];\n};\n\nexport function translate(m, x, y) {\n  return [\n    m[0],\n    m[1],\n    m[2],\n    m[3],\n    m[0] * x + m[2] * y + m[4],\n    m[1] * x + m[3] * y + m[5]\n  ];\n};\n\nexport function rotate(m, angle) {\n  angle = angle * Math.PI / 180;\n\n  let cosValue = Math.cos(angle);\n  let sinValue = Math.sin(angle);\n\n  return [\n    m[0] * cosValue + m[2] * sinValue,\n    m[1] * cosValue + m[3] * sinValue,\n    m[0] * (-sinValue) + m[2] * cosValue,\n    m[1] * (-sinValue) + m[3] * cosValue,\n    m[4],\n    m[5]\n  ];\n};\n\nexport function scale(m, x, y) {\n  return [\n    m[0] * x,\n    m[1] * x,\n    m[2] * y,\n    m[3] * y,\n    m[4],\n    m[5]\n  ];\n};\n\nexport function makePoint(x, y, z) {\n  return { x: x, y: y, z: z };\n};\n\nexport function makeVector(xcoord, ycoord, zcoord) {\n  return { xcoord: xcoord, ycoord: ycoord, zcoord: zcoord };\n};\n\nexport function makeVectorFromPoints(pt1, pt2) {\n  let xcoord = pt2.x - pt1.x;\n  let ycoord = pt2.y - pt1.y;\n  let zcoord = pt2.z - pt1.z;\n  return makeVector(xcoord, ycoord, zcoord);\n};\n\nexport function addVector(pt, v) {\n  return makePoint(pt.x + v.xcoord, pt.y + v.ycoord, pt.z + v.zcoord);\n};\n\nexport function multiplyVector(v, scalar) {\n  return makeVector(v.xcoord * scalar, v.ycoord * scalar, v.zcoord * scalar);\n};\n\nexport function magnitude(v) {\n  return Math.sqrt(\n    Math.pow(v.xcoord, 2) + Math.pow(v.ycoord, 2) + Math.pow(v.zcoord, 2)\n  );\n};\n\nexport function negateVector(v) {\n  return multiplyVector(v, -1);\n};\n\nexport function unitVector(v) {\n  let mag = magnitude(v);\n  let xcoord = v.xcoord / mag;\n  let ycoord = v.ycoord / mag;\n  let zcoord = v.zcoord / mag;\n  return makeVector(xcoord, ycoord, zcoord);\n};\n\nexport function crossProduct(u, v) {\n  //\n  // u X v = < u2*v3 - u3*v2,\n  //           u3*v1 - u1*v3,\n  //           u1*v2 - u2*v1 >\n  let xcoord = u.ycoord * v.zcoord - u.zcoord * v.ycoord;\n  let ycoord = u.zcoord * v.xcoord - u.xcoord * v.zcoord;\n  let zcoord = u.xcoord * v.ycoord - u.ycoord * v.xcoord;\n  return makeVector(xcoord, ycoord, zcoord);\n};\n","import setAttributes from '../utils/setAttributes';\nimport normalizeColor from '../utils/normalizeColor';\nimport {\n  makePoint, makeVector, makeVectorFromPoints,\n  magnitude, unitVector, crossProduct,\n  addVector, multiplyVector, negateVector\n} from '../utils/mathUtils';\n\n/**\n * Create SVGPathElement from an annotation definition.\n * This is used for anntations of type `drawing`.\n *\n * @param {Object} a The annotation definition\n * @return {SVGPathElement} The path to be rendered\n */\nexport default function renderArrow(a) {\n  let arrow = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');\n\n  if (a.lines.length === 2) {\n    let p1 = a.lines[0];\n    let p2 = a.lines[a.lines.length - 1];\n\n    let arrowLength = 40;\n    let pt0 = makePoint(p1[0], p1[1], 0);\n    let pt1 = makePoint(p2[0], p2[1], 0);\n    let x = makeVectorFromPoints(pt0, pt1);\n    let unitX = unitVector(x);\n    pt1 = addVector(pt0, multiplyVector(unitX, arrowLength));\n    x = makeVectorFromPoints(pt0, pt1);\n    let unitZ = makeVector(0, 0, 1);\n    let unitY = unitVector(crossProduct(unitX, unitZ));\n    let thickness = a.width || 10;\n\n    let A = addVector(pt0, multiplyVector(unitY, thickness * 0.5));\n    let B = addVector(A, multiplyVector(unitX, magnitude(x) - thickness * 2.0));\n    let C = addVector(B, multiplyVector(unitY, thickness));\n    let D = pt1;\n    let G = addVector(pt0, multiplyVector(negateVector(unitY), thickness * 0.5));\n    let F = addVector(G, multiplyVector(unitX, magnitude(x) - thickness * 2.0));\n    let E = addVector(F, multiplyVector(negateVector(unitY), thickness));\n\n    let points = '' +\n      A.x + ',' + A.y + ' ' +\n      B.x + ',' + B.y + ' ' +\n      C.x + ',' + C.y + ' ' +\n      D.x + ',' + D.y + ' ' +\n      E.x + ',' + E.y + ' ' +\n      F.x + ',' + F.y + ' ' +\n      G.x + ',' + G.y;\n\n    setAttributes(arrow, {\n      points: points,\n      stroke: normalizeColor(a.color || '#000'),\n      fill: normalizeColor(a.color || '#000')\n    });\n  }\n\n  return arrow;\n}\n","import renderLine from \"./renderLine\";\nimport renderPath from \"./renderPath\";\nimport renderPoint from \"./renderPoint\";\nimport renderRect from \"./renderRect\";\nimport renderStamp from \"./renderStamp\";\nimport renderText from \"./renderText\";\nimport renderSignatureBlock from \"./renderSignatureBlock\";\nimport renderArrow from \"./renderArrow\";\n\nconst isFirefox = /firefox/i.test(navigator.userAgent);\n\n/**\n * Get the x/y translation to be used for transforming the annotations\n * based on the rotation of the viewport.\n *\n * @param {Object} viewport The viewport data from the page\n * @return {Object}\n */\nexport function getTranslation(viewport) {\n  let x;\n  let y;\n\n  // Modulus 360 on the rotation so that we only\n  // have to worry about four possible values.\n  switch (viewport.rotation % 360) {\n    case 0:\n      x = y = 0;\n      break;\n    case 90:\n      x = 0;\n      y = (viewport.width / viewport.scale) * -1;\n      break;\n    case 180:\n      x = (viewport.width / viewport.scale) * -1;\n      y = (viewport.height / viewport.scale) * -1;\n      break;\n    case 270:\n      x = (viewport.height / viewport.scale) * -1;\n      y = 0;\n      break;\n  }\n\n  return { x, y };\n}\n\n/**\n * Transform the rotation and scale of a node using SVG's native transform attribute.\n *\n * @param {Node} node The node to be transformed\n * @param {Object} viewport The page's viewport data\n * @return {Node}\n */\nfunction transform(node, viewport) {\n  let trans = getTranslation(viewport);\n\n  // Let SVG natively transform the element\n  node.setAttribute(\n    \"transform\",\n    `scale(${viewport.scale}) rotate(${viewport.rotation}) translate(${trans.x}, ${trans.y})`\n  );\n\n  // Manually adjust x/y for nested SVG nodes\n  if (!isFirefox && node.nodeName.toLowerCase() === \"svg\") {\n    node.setAttribute(\n      \"x\",\n      parseInt(node.getAttribute(\"x\"), 10) * viewport.scale\n    );\n    node.setAttribute(\n      \"y\",\n      parseInt(node.getAttribute(\"y\"), 10) * viewport.scale\n    );\n\n    let x = parseInt(node.getAttribute(\"x\", 10));\n    let y = parseInt(node.getAttribute(\"y\", 10));\n    let width = parseInt(node.getAttribute(\"width\"), 10);\n    let height = parseInt(node.getAttribute(\"height\"), 10);\n    let path = node.querySelector(\"path\");\n    let svg = path.parentNode;\n\n    // Scale width/height\n    [node, svg, path, node.querySelector(\"rect\")].forEach((n) => {\n      n.setAttribute(\n        \"width\",\n        parseInt(n.getAttribute(\"width\"), 10) * viewport.scale\n      );\n      n.setAttribute(\n        \"height\",\n        parseInt(n.getAttribute(\"height\"), 10) * viewport.scale\n      );\n    });\n\n    // Transform path but keep scale at 100% since it will be handled natively\n    transform(path, Object.assign({}, viewport, { scale: 1 }));\n\n    switch (viewport.rotation % 360) {\n      case 90:\n        node.setAttribute(\"x\", viewport.width - y - width);\n        node.setAttribute(\"y\", x);\n        svg.setAttribute(\"x\", 1);\n        svg.setAttribute(\"y\", 0);\n        break;\n      case 180:\n        node.setAttribute(\"x\", viewport.width - x - width);\n        node.setAttribute(\"y\", viewport.height - y - height);\n        svg.setAttribute(\"y\", 2);\n        break;\n      case 270:\n        node.setAttribute(\"x\", y);\n        node.setAttribute(\"y\", viewport.height - x - height);\n        svg.setAttribute(\"x\", -1);\n        svg.setAttribute(\"y\", 0);\n        break;\n    }\n  }\n\n  return node;\n}\n\n/**\n * Append an annotation as a child of an SVG.\n *\n * @param {SVGElement} svg The SVG element to append the annotation to\n * @param {Object} annotation The annotation definition to render and append\n * @param {Object} viewport The page's viewport data\n * @return {SVGElement} A node that was created and appended by this function\n */\nexport function appendChild(svg, annotation, viewport) {\n  if (!viewport) {\n    viewport = JSON.parse(svg.getAttribute(\"data-pdf-annotate-viewport\"));\n  }\n\n  let child;\n  switch (annotation.type) {\n    case \"area\":\n    case \"highlight\":\n      child = renderRect(annotation);\n      break;\n    case \"signature\":\n      child = renderSignatureBlock(annotation);\n      break;\n    case \"strikeout\":\n      child = renderLine(annotation);\n      break;\n    case \"point\":\n      child = renderPoint(annotation);\n      break;\n    case \"textbox\":\n      child = renderText(annotation);\n      break;\n    case \"drawing\":\n      child = renderPath(annotation);\n      break;\n    case \"arrow\":\n      child = renderArrow(annotation);\n    case \"stamp\":\n      child = renderStamp(annotation);\n      break;\n      break;\n  }\n\n  // If no type was provided for an annotation it will result in node being null.\n  // Skip appending/transforming if node doesn't exist.\n  if (child) {\n    // Set attributes\n    child.setAttribute(\"data-pdf-annotate-id\", annotation.uuid);\n    child.setAttribute(\"aria-hidden\", true);\n\n    // Dynamically set any other attributes associated with annotation that is not related to drawing it\n    Object.keys(annotation)\n      .filter((key) => {\n        return (\n          [\n            \"color\",\n            \"x\",\n            \"y\",\n            \"cx\",\n            \"cy\",\n            \"color\",\n            \"documentId\",\n            \"lines\",\n            \"page\",\n            \"width\",\n            \"class\",\n            \"content\",\n            \"size\",\n            \"rotation\",\n            \"r\",\n          ].indexOf(key) === -1\n        );\n      })\n      .forEach((key) => {\n        child.setAttribute(`data-pdf-annotate-${key}`, annotation[key]);\n      });\n\n    svg.appendChild(transform(child, viewport));\n  }\n\n  return child;\n}\n\n/**\n * Transform a child annotation of an SVG.\n *\n * @param {SVGElement} svg The SVG element with the child annotation\n * @param {Object} child The SVG child to transform\n * @param {Object} viewport The page's viewport data\n * @return {SVGElement} A node that was transformed by this function\n */\nexport function transformChild(svg, child, viewport) {\n  if (!viewport) {\n    viewport = JSON.parse(svg.getAttribute(\"data-pdf-annotate-viewport\"));\n  }\n\n  // If no type was provided for an annotation it will result in node being null.\n  // Skip transforming if node doesn't exist.\n  if (child) {\n    child = transform(child, viewport);\n  }\n\n  return child;\n}\n\nexport default {\n  /**\n   * Get the x/y translation to be used for transforming the annotations\n   * based on the rotation of the viewport.\n   */\n  getTranslation,\n\n  /**\n   * Append an SVG child for an annotation\n   */\n  appendChild,\n\n  /**\n   * Transform an existing SVG child\n   */\n  transformChild,\n};\n","import setAttributes from '../utils/setAttributes';\nimport normalizeColor from '../utils/normalizeColor';\n\n/**\n * Create SVGLineElements from an annotation definition.\n * This is used for anntations of type `strikeout`.\n *\n * @param {Object} a The annotation definition\n * @return {SVGGElement} A group of all lines to be rendered\n */\nexport default function renderLine(a) {\n  let group = document.createElementNS('http://www.w3.org/2000/svg', 'g');\n  setAttributes(group, {\n    stroke: normalizeColor(a.color || '#f00'),\n    strokeWidth: 1\n  });\n\n  a.rectangles.forEach((r) => {\n    let line = document.createElementNS('http://www.w3.org/2000/svg', 'line');\n\n    setAttributes(line, {\n      x1: r.x,\n      y1: r.y,\n      x2: r.x + r.width,\n      y2: r.y\n    });\n\n    group.appendChild(line);\n  });\n\n  return group;\n}\n","import setAttributes from '../utils/setAttributes';\nimport normalizeColor from '../utils/normalizeColor';\n\n/**\n * Create SVGPathElement from an annotation definition.\n * This is used for anntations of type `drawing`.\n *\n * @param {Object} a The annotation definition\n * @return {SVGPathElement} The path to be rendered\n */\nexport default function renderPath(a) {\n  let d = [];\n  let path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n\n  if (a.lines.length > 0) {\n    d.push(`M${a.lines[0][0]} ${a.lines[0][1]}`);\n    for (let i = 1, l = a.lines.length; i < l; i++) {\n      let p1 = a.lines[i];\n      let p2 = a.lines[i + 1];\n      if (p2) {\n        d.push(`L${p1[0]} ${p1[1]}`);\n      }\n    }\n  }\n\n  /*\n\n   if(a.lines.length>2) {\n    var p1 = a.lines[0];\n    var p2 = a.lines[a.lines.length-1];\n\n    var p3 = []; //arrow\n    var p4 = [];\n    var p0 = []; //arrow intersection\n\n    if (p2) {\n      var k = -(p2[0]-p1[0])/(p2[1]-p1[1]);\n\n      var deltaX = 3;\n      p0[0] = p1[0]+0.8*(p2[0]-p1[0]);\n      p0[1] = p1[1]+0.8*(p2[1]-p1[1]);\n\n      p3[0] = p0[0] + deltaX;\n      p3[1] = p0[1] + k*deltaX;\n\n      p4[0] = p0[0] - deltaX;\n      p4[1] = p0[1] - k*deltaX;\n\n      if(Math.abs(p2[1]-p1[1]) < 20) {\n\n        p3[0] = p0[0] ;\n        p3[1] = p0[1] + deltaX*1;\n\n        p4[0] = p0[0] ;\n        p4[1] = p0[1] - deltaX*1;\n\n      }\n\n      d.push(`M${p1[0]} ${p1[1]} ${p2[0]} ${p2[1]}`);\n       //d.push(`M${p1[0]} ${p1[1]} ${p2[0]} ${p2[1]}`);\n      d.push(`M${p2[0]} ${p2[1]} ${p3[0]} ${p3[1]}`);\n      d.push(`M${p3[0]} ${p3[1]} ${p4[0]} ${p4[1]}`);\n      d.push(`M${p4[0]} ${p4[1]} ${p2[0]} ${p2[1]}`);\n     }\n    } */\n\n  setAttributes(path, {\n    d: `${d.join(' ')}`, // `${d.join(' ')}Z`,\n    stroke: normalizeColor(a.color || '#000'),\n    strokeWidth: a.width || 1,\n    fill: 'none'\n  });\n\n  return path;\n}\n","import { getTranslation } from '../render/appendChild';\nimport {\n  applyTransform,\n  applyInverseTransform,\n  translate,\n  rotate,\n  scale\n} from '../utils/mathUtils';\n\nexport const BORDER_COLOR = '#00BFFF';\n\nconst userSelectStyleSheet = document.createElement('style');\nuserSelectStyleSheet.innerHTML = `\nbody {\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n`;\n\nuserSelectStyleSheet.setAttribute('data-pdf-annotate-user-select', 'true');\n\n/**\n * Find the SVGElement that contains all the annotations for a page\n *\n * @param {Element} node An annotation within that container\n * @return {SVGElement} The container SVG or null if it can't be found\n */\nexport function findSVGContainer(node) {\n  let parentNode = node;\n\n  while ((parentNode = parentNode.parentNode) &&\n          parentNode !== document) {\n    if (parentNode.nodeName.toUpperCase() === 'SVG' &&\n        parentNode.getAttribute('data-pdf-annotate-container') === 'true') {\n      return parentNode;\n    }\n  }\n\n  return null;\n}\n\n/**\n * Find an SVGElement container at a given point\n *\n * @param {Number} x The x coordinate of the point\n * @param {Number} y The y coordinate of the point\n * @return {SVGElement} The container SVG or null if one can't be found\n */\nexport function findSVGAtPoint(x, y) {\n  let elements = document.querySelectorAll('svg[data-pdf-annotate-container=\"true\"]');\n\n  for (let i = 0, l = elements.length; i < l; i++) {\n    let el = elements[i];\n    let rect = el.getBoundingClientRect();\n\n    if (pointIntersectsRect(x, y, rect)) {\n      return el;\n    }\n  }\n\n  return null;\n}\n\n/**\n * Find an Element that represents an annotation at a given point.\n *\n * IMPORTANT: Requires the annotation layer to be the top most element so\n *            either use z-ordering or make it the leaf container.\n *\n * @param {Number} x The x coordinate of the point\n * @param {Number} y The y coordinate of the point\n * @return {Element} The annotation element or null if one can't be found\n */\nexport function findAnnotationAtPoint(x, y) {\n  let el = null;\n  let candidate = document.elementFromPoint(x, y);\n  while (!el && candidate && candidate !== document) {\n    let type = candidate.getAttribute('data-pdf-annotate-type');\n    if (type) {\n      el = candidate;\n    }\n    candidate = candidate.parentNode;\n  }\n  return el;\n}\n\n/**\n * Determine if a point intersects a rect\n *\n * @param {Number} x The x coordinate of the point\n * @param {Number} y The y coordinate of the point\n * @param {Object} rect The points of a rect (likely from getBoundingClientRect)\n * @return {Boolean} True if a collision occurs, otherwise false\n */\nexport function pointIntersectsRect(x, y, rect) {\n  return y >= rect.top && y <= rect.bottom && x >= rect.left && x <= rect.right;\n}\n\n/**\n * Get the rect of an annotation element accounting for offset.\n *\n * @param {Element} el The element to get the rect of\n * @return {Object} The dimensions of the element\n */\nexport function getOffsetAnnotationRect(el) {\n  let rect = el.getBoundingClientRect();\n  let { width, height } = rect;\n  let extraOffsetWidth = 0;\n  let extraOffsetHeight = 0;\n  if (['line', 'path'].indexOf(el.tagName.toLowerCase()) > -1 && el.getBBox) {\n    let bbox = el.getBBox();\n    extraOffsetWidth = (rect.width - bbox.width) / 2;\n    extraOffsetHeight = (rect.height - bbox.height) / 2;\n    width = bbox.width;\n    height = bbox.height;\n  }\n  let { offsetLeft, offsetTop } = getOffset(el);\n  return {\n    top: rect.top - offsetTop + extraOffsetHeight,\n    left: rect.left - offsetLeft + extraOffsetWidth,\n    bottom: rect.bottom - offsetTop - extraOffsetHeight,\n    right: rect.right - offsetLeft - extraOffsetWidth,\n    width: width,\n    height: height\n  };\n}\n\n/**\n * Adjust scale from normalized scale (100%) to rendered scale.\n *\n * @param {SVGElement} svg The SVG to gather metadata from\n * @param {Object} rect A map of numeric values to scale\n * @return {Object} A copy of `rect` with values scaled up\n */\nexport function scaleUp(svg, rect) {\n  let result = {};\n  let { viewport } = getMetadata(svg);\n\n  Object.keys(rect).forEach((key) => {\n    result[key] = rect[key] * viewport.scale;\n  });\n\n  return result;\n}\n\nexport function convertToSvgRect(rect, svg, viewport) {\n  let pt1 = [rect.x, rect.y];\n  let pt2 = [rect.x + rect.width, rect.y + rect.height];\n\n  pt1 = convertToSvgPoint(pt1, svg, viewport);\n  pt2 = convertToSvgPoint(pt2, svg, viewport);\n\n  return {\n    x: Math.min(pt1[0], pt2[0]),\n    y: Math.min(pt1[1], pt2[1]),\n    width: Math.abs(pt2[0] - pt1[0]),\n    height: Math.abs(pt2[1] - pt1[1])\n  };\n}\n\nexport function convertToSvgPoint(pt, svg, viewport) {\n  viewport = viewport || getMetadata(svg).viewport;\n\n  let xform = [ 1, 0, 0, 1, 0, 0 ];\n  xform = scale(xform, viewport.scale, viewport.scale);\n  xform = rotate(xform, viewport.rotation);\n\n  let offset = getTranslation(viewport);\n  xform = translate(xform, offset.x, offset.y);\n\n  return applyInverseTransform(pt, xform);\n}\n\nexport function convertToScreenPoint(pt, svg, viewport) {\n  viewport = viewport || getMetadata(svg).viewport;\n\n  let xform = [ 1, 0, 0, 1, 0, 0 ];\n  xform = scale(xform, viewport.scale, viewport.scale);\n  xform = rotate(xform, viewport.rotation);\n\n  let offset = getTranslation(viewport);\n  xform = translate(xform, offset.x, offset.y);\n\n  return applyTransform(pt, xform);\n}\n\n/**\n * Adjust scale from rendered scale to a normalized scale (100%).\n *\n * @param {SVGElement} svg The SVG to gather metadata from\n * @param {Object} rect A map of numeric values to scale\n * @return {Object} A copy of `rect` with values scaled down\n */\nexport function scaleDown(svg, rect) {\n  let result = {};\n  let { viewport } = getMetadata(svg);\n\n  Object.keys(rect).forEach((key) => {\n    result[key] = rect[key] / viewport.scale;\n  });\n\n  return result;\n}\n\n/**\n * Get the scroll position of an element, accounting for parent elements\n *\n * @param {Element} el The element to get the scroll position for\n * @return {Object} The scrollTop and scrollLeft position\n */\nexport function getScroll(el) {\n  let scrollTop = 0;\n  let scrollLeft = 0;\n  let parentNode = el;\n\n  while ((parentNode = parentNode.parentNode) &&\n          parentNode !== document) {\n    scrollTop += parentNode.scrollTop;\n    scrollLeft += parentNode.scrollLeft;\n  }\n\n  return { scrollTop, scrollLeft };\n}\n\n/**\n * Get the offset position of an element, accounting for parent elements\n *\n * @param {Element} el The element to get the offset position for\n * @return {Object} The offsetTop and offsetLeft position\n */\nexport function getOffset(el) {\n  let parentNode = el;\n\n  while ((parentNode = parentNode.parentNode) &&\n          parentNode !== document) {\n    if (parentNode.nodeName.toUpperCase() === 'SVG') {\n      break;\n    }\n  }\n\n  let rect = parentNode.getBoundingClientRect();\n\n  return { offsetLeft: rect.left, offsetTop: rect.top };\n}\n\n/**\n * Disable user ability to select text on page\n */\nexport function disableUserSelect() {\n  if (!userSelectStyleSheet.parentNode) {\n    document.head.appendChild(userSelectStyleSheet);\n  }\n}\n\n/**\n * Enable user ability to select text on page\n */\nexport function enableUserSelect() {\n  if (userSelectStyleSheet.parentNode) {\n    userSelectStyleSheet.parentNode.removeChild(userSelectStyleSheet);\n  }\n}\n\n/**\n * Get the metadata for a SVG container\n *\n * @param {SVGElement} svg The SVG container to get metadata for\n */\nexport function getMetadata(svg) {\n  return {\n    documentId: svg.getAttribute('data-pdf-annotate-document'),\n    pageNumber: parseInt(svg.getAttribute('data-pdf-annotate-page'), 10),\n    viewport: JSON.parse(svg.getAttribute('data-pdf-annotate-viewport'))\n  };\n}\n","import EventEmitter from 'events';\nimport {\n  findAnnotationAtPoint,\n  findSVGAtPoint\n} from './utils';\n\nconst emitter = new EventEmitter();\n\nlet clickNode;\n\n/**\n * Handle document.click event\n *\n * @param {Event} e The DOM event to be handled\n */\ndocument.addEventListener('click', function handleDocumentClick(e) {\n  if (!findSVGAtPoint(e.clientX, e.clientY)) {\n    return;\n  }\n\n  let target = findAnnotationAtPoint(e.clientX, e.clientY);\n\n  // Emit annotation:blur if clickNode is no longer clicked\n  if (clickNode && clickNode !== target) {\n    emitter.emit('annotation:blur', clickNode);\n  }\n\n  // Emit annotation:click if target was clicked\n  if (target) {\n    emitter.emit('annotation:click', target);\n  }\n\n  clickNode = target;\n});\n\n// let mouseOverNode;\n// document.addEventListener('mousemove', function handleDocumentMousemove(e) {\n//   let target = findAnnotationAtPoint(e.clientX, e.clientY);\n//\n//   // Emit annotation:mouseout if target was mouseout'd\n//   if (mouseOverNode && !target) {\n//     emitter.emit('annotation:mouseout', mouseOverNode);\n//   }\n//\n//   // Emit annotation:mouseover if target was mouseover'd\n//   if (target && mouseOverNode !== target) {\n//     emitter.emit('annotation:mouseover', target);\n//   }\n//\n//   mouseOverNode = target;\n// });\n\nexport function fireEvent() { emitter.emit(...arguments); };\nexport function addEventListener() { emitter.on(...arguments); };\nexport function removeEventListener() { emitter.removeListener(...arguments); };\n","// Disable JSDoc as it cannot really deal with the odd way that the functions are defined\n/* eslint valid-jsdoc: 0 */\n\nimport abstractFunction from '../utils/abstractFunction';\nimport { fireEvent } from '../UI/event';\n\n// Adapter should never be invoked publicly\nexport default class StoreAdapter {\n  /**\n   * Create a new StoreAdapter instance\n   *\n   * @param {Object} [definition] The definition to use for overriding abstract methods\n   */\n  constructor(definition = {}) {\n    // Copy each function from definition if it is a function we know about\n    Object.keys(definition).forEach((key) => {\n      if (typeof definition[key] === 'function' &&\n          typeof this[key] === 'function') {\n        this[key] = definition[key];\n      }\n    });\n  }\n\n  /**\n   * Get all the annotations for a given document and page number.\n   *\n   * @param {String} documentId The ID for the document the annotations belong to\n   * @param {Number} pageNumber The number of the page the annotations belong to\n   * @return {Promise} Promise that returns with list of annotations for document and page\n   */\n  __getAnnotations(documentId, pageNumber) { abstractFunction('getAnnotations'); }\n  get getAnnotations() { return this.__getAnnotations; }\n  set getAnnotations(fn) {\n    this.__getAnnotations = function getAnnotations(documentId, pageNumber) {\n      return fn(...arguments).then((annotations) => {\n        // TODO may be best to have this happen on the server\n        if (annotations.annotations) {\n          annotations.annotations.forEach((a) => {\n            a.documentId = documentId;\n          });\n        }\n        return annotations;\n      });\n    };\n  }\n\n  /**\n   * Get the definition for a specific annotation.\n   *\n   * @param {String} documentId The ID for the document the annotation belongs to\n   * @param {String} annotationId The ID for the annotation\n   * @return {Promise} Promise that returns the requested annotation\n   */\n  getAnnotation(documentId, annotationId) { abstractFunction('getAnnotation'); }\n\n  /**\n   * Add an annotation\n   *\n   * @param {String} documentId The ID for the document to add the annotation to\n   * @param {String} pageNumber The page number to add the annotation to\n   * @param {Object} annotation The definition for the new annotation\n   * @return {Promise} Promise that returns with the added annotation\n   */\n  __addAnnotation(documentId, pageNumber, annotation) { abstractFunction('addAnnotation'); }\n  get addAnnotation() { return this.__addAnnotation; }\n  set addAnnotation(fn) {\n    this.__addAnnotation = function addAnnotation(documentId, pageNumber, annotation) {\n      return fn(...arguments).then((annotation) => {\n        fireEvent('annotation:add', documentId, pageNumber, annotation);\n        return annotation;\n      });\n    };\n  }\n\n  /**\n   * Edit an annotation\n   *\n   * @param {String} documentId The ID for the document\n   * @param {String} pageNumber the page number of the annotation\n   * @param {Object} annotation The definition of the modified annotation\n   * @return {Promise} Promise that returns with the edited annotation\n   */\n  __editAnnotation(documentId, pageNumber, annotation) { abstractFunction('editAnnotation'); }\n  get editAnnotation() { return this.__editAnnotation; }\n  set editAnnotation(fn) {\n    this.__editAnnotation = function editAnnotation(documentId, annotationId, annotation) {\n      return fn(...arguments).then((annotation) => {\n        fireEvent('annotation:edit', documentId, annotationId, annotation);\n        return annotation;\n      });\n    };\n  }\n\n  /**\n   * Delete an annotation\n   *\n   * @param {String} documentId The ID for the document\n   * @param {String} annotationId The ID for the annotation\n   * @return {Promise} Promise that returns with boolean if annotation was deleted\n   */\n  __deleteAnnotation(documentId, annotationId) { abstractFunction('deleteAnnotation'); }\n  get deleteAnnotation() { return this.__deleteAnnotation; }\n  set deleteAnnotation(fn) {\n    this.__deleteAnnotation = function deleteAnnotation(documentId, annotationId) {\n      return fn(...arguments).then((success) => {\n        if (success) {\n          fireEvent('annotation:delete', documentId, annotationId);\n        }\n        return success;\n      });\n    };\n  }\n\n  /**\n   * Get all the comments for an annotation\n   *\n   * @param {String} documentId The ID for the document\n   * @param {String} annotationId The ID for the annotation\n   * @return {Promise} Promise that returns with comments for annotation\n   */\n  getComments(documentId, annotationId) { abstractFunction('getComments'); }\n\n  /**\n   * Add a new comment\n   *\n   * @param {String} documentId The ID for the document\n   * @param {String} annotationId The ID for the annotation\n   * @param {Object} content The definition of the comment\n   * @return {Promise} Promise that returns with the added comment\n   */\n  __addComment(documentId, annotationId, content) { abstractFunction('addComment'); }\n  get addComment() { return this.__addComment; }\n  set addComment(fn) {\n    this.__addComment = function addComment(documentId, annotationId, content) {\n      return fn(...arguments).then((comment) => {\n        fireEvent('comment:add', documentId, annotationId, comment);\n        return comment;\n      });\n    };\n  }\n\n  /**\n   * Delete a comment\n   *\n   * @param {String} documentId The ID for the document\n   * @param {String} commentId The ID for the comment\n   * @return {Promise} Promise that returns with boolean if comment was deleted\n   */\n  __deleteComment(documentId, commentId) { abstractFunction('deleteComment'); }\n  get deleteComment() { return this.__deleteComment; }\n  set deleteComment(fn) {\n    this.__deleteComment = function deleteComment(documentId, commentId) {\n      return fn(...arguments).then((success) => {\n        if (success) {\n          fireEvent('comment:delete', documentId, commentId);\n        }\n        return success;\n      });\n    };\n  }\n}\n","const REGEXP = /[xy]/g;\nconst PATTERN = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx';\n\nfunction replacement(c) {\n  let r = Math.random() * 16 | 0;\n  let v = c === 'x' ? r : (r & 0x3 | 0x8);\n  return v.toString(16);\n}\n\n/**\n * Generate a univierally unique identifier\n *\n * @return {String} A UUID\n */\nexport default function uuid() {\n  return PATTERN.replace(REGEXP, replacement);\n}\n","import uuid from '../utils/uuid';\nimport StoreAdapter from './StoreAdapter';\n\n// StoreAdapter for working with localStorage\n// This is ideal for testing, examples, and prototyping\nexport default class LocalStoreAdapter extends StoreAdapter {\n  constructor() {\n    super({\n      getAnnotations(documentId, pageNumber) {\n        return new Promise((resolve, reject) => {\n          let annotations = getAnnotations(documentId).filter((i) => {\n            return i.page === pageNumber && i.class === 'Annotation';\n          });\n\n          resolve({\n            documentId,\n            pageNumber,\n            annotations\n          });\n        });\n      }\n    });\n\n    this.getAnnotation = (documentId, annotationId) => {\n      return Promise.resolve(getAnnotations(documentId)[findAnnotation(documentId, annotationId)]);\n    };\n\n    this.addAnnotation = (documentId, pageNumber, annotation) => {\n      return new Promise((resolve, reject) => {\n        annotation.class = 'Annotation';\n        annotation.uuid = uuid();\n        annotation.page = pageNumber;\n\n        let annotations = getAnnotations(documentId);\n        annotations.push(annotation);\n        updateAnnotations(documentId, annotations);\n\n        resolve(annotation);\n      });\n    };\n\n    this.editAnnotation = (documentId, annotationId, annotation) => {\n      return new Promise((resolve, reject) => {\n        let annotations = getAnnotations(documentId);\n        annotations[findAnnotation(documentId, annotationId)] = annotation;\n        updateAnnotations(documentId, annotations);\n        resolve(annotation);\n      });\n    };\n\n    this.deleteAnnotation = (documentId, annotationId) => {\n      return new Promise((resolve, reject) => {\n        let annotation = getAnnotations(documentId).filter(i => i.uuid === annotationId)[0] || {};\n        if (!annotation) {\n          return reject('Could not find annotation');\n        }\n        let index = findAnnotation(documentId, annotationId);\n        if (index > -1) {\n          let annotations = getAnnotations(documentId);\n          annotations.splice(index, 1);\n          updateAnnotations(documentId, annotations);\n        }\n\n        resolve(true);\n      });\n    };\n\n    this.getComments = (documentId, annotationId) => {\n      return new Promise((resolve, reject) => {\n        resolve(getAnnotations(documentId).filter((i) => {\n          return i.class === 'Comment' && i.annotation === annotationId;\n        }));\n      });\n    };\n\n    this.addComment = (documentId, annotationId, content) => {\n      return new Promise((resolve, reject) => {\n        let comment = {\n          class: 'Comment',\n          uuid: uuid(),\n          annotation: annotationId,\n          content: content\n        };\n\n        let annotations = getAnnotations(documentId);\n        annotations.push(comment);\n        updateAnnotations(documentId, annotations);\n\n        resolve(comment);\n      });\n    };\n\n    this.deleteComment = (documentId, commentId) => {\n      return new Promise((resolve, reject) => {\n        let comment = getAnnotations(documentId).filter(i => i.uuid === commentId)[0] || {};\n        if (!comment) {\n          return reject('Could not find annotation');\n        }\n        let index = -1;\n        let annotations = getAnnotations(documentId);\n        for (let i = 0, l = annotations.length; i < l; i++) {\n          if (annotations[i].uuid === commentId) {\n            index = i;\n            break;\n          }\n        }\n\n        if (index > -1) {\n          annotations.splice(index, 1);\n          updateAnnotations(documentId, annotations);\n        }\n\n        resolve(true);\n      });\n    };\n  }\n}\n\nfunction getAnnotations(documentId) {\n  return JSON.parse(localStorage.getItem(`${documentId}/annotations`)) || [];\n}\n\nfunction updateAnnotations(documentId, annotations) {\n  localStorage.setItem(`${documentId}/annotations`, JSON.stringify(annotations));\n}\n/**\n *\n * @param {String} documentId Document id of the annotation\n * @param {String} annotationId The id of the annotation\n *\n * This function finds all the annotation made by one user.\n *\n * @return {int} The index of the annotation in localstorage\n */\nfunction findAnnotation(documentId, annotationId) {\n  let index = -1;\n  let annotations = getAnnotations(documentId);\n  for (let i = 0, l = annotations.length; i < l; i++) {\n    if (annotations[i].uuid === annotationId) {\n      index = i;\n      break;\n    }\n  }\n  return index;\n}\n","import uuid from '../utils/uuid';\nimport StoreAdapter from './StoreAdapter';\n\n// StoreAdapter for working with localStorage and associated user id\n// This is ideal for testing, examples, and prototyping\nexport default class LocalUserStoreAdapter extends StoreAdapter {\n  constructor(userId = 'user', globalEdit = false) {\n    super({\n      getAnnotations(documentId, pageNumber) {\n        return new Promise((resolve, reject) => {\n          let annotations = getAllAnnotations(documentId).filter((i) => {\n            return i.page === pageNumber && i.class === 'Annotation';\n          });\n\n          resolve({\n            documentId,\n            pageNumber,\n            annotations\n          });\n        });\n      }\n    });\n\n    this._userId = userId;\n    this._globalEdit = globalEdit;\n\n    this.getAnnotation = (documentId, annotationId) => {\n      return Promise.resolve(getAnnotations(documentId, this._userId)[findAnnotation(documentId, this._userId, annotationId)]);\n    };\n\n    this.addAnnotation = (documentId, pageNumber, annotation) => {\n      return new Promise((resolve, reject) => {\n        annotation.class = 'Annotation';\n        annotation.uuid = uuid();\n        annotation.page = pageNumber;\n        annotation.userId = this._userId;\n\n        let annotations = getAnnotations(documentId, this._userId);\n        annotations.push(annotation);\n        updateAnnotations(documentId, this._userId, annotations);\n\n        resolve(annotation);\n      });\n    };\n\n    this.editAnnotation = (documentId, annotationId, annotation) => {\n      return new Promise((resolve, reject) => {\n        if (!this._globalEdit && annotation.userId && annotation.userId !== this._userId) {\n          reject('Non-matching userId');\n        }\n        let annotations = getAnnotations(documentId, annotation.userId);\n        annotations[findAnnotation(documentId, annotation.userId, annotationId)] = annotation;\n        updateAnnotations(documentId, annotation.userId, annotations);\n        resolve(annotation);\n      });\n    };\n\n    this.deleteAnnotation = (documentId, annotationId) => {\n      return new Promise((resolve, reject) => {\n        let annotation = getAllAnnotations(documentId).filter(i => i.uuid === annotationId)[0] || {};\n        if (!annotation) {\n          return reject('Could not find annotation');\n        }\n        else if (!this._globalEdit && annotation.userId && annotation.userId !== this._userId) {\n          return reject('Non-matching userId');\n        }\n        let index = findAnnotation(documentId, annotation.userId, annotationId);\n        if (index > -1) {\n          let annotations = getAnnotations(documentId, annotation.userId);\n          annotations.splice(index, 1);\n          updateAnnotations(documentId, annotation.userId, annotations);\n        }\n\n        resolve(true);\n      });\n    };\n\n    this.getComments = (documentId, annotationId) => {\n      return new Promise((resolve, reject) => {\n        resolve(getAnnotations(documentId, this._userId).filter((i) => {\n          return i.class === 'Comment' && i.annotation === annotationId;\n        }));\n      });\n    };\n\n    this.addComment = (documentId, annotationId, content) => {\n      return new Promise((resolve, reject) => {\n        let comment = {\n          class: 'Comment',\n          uuid: uuid(),\n          annotation: annotationId,\n          content: content,\n          userId: this._userId\n        };\n\n        let annotations = getAnnotations(documentId, this._userId);\n        annotations.push(comment);\n        updateAnnotations(documentId, this._userId, annotations);\n\n        resolve(comment);\n      });\n    };\n\n    this.deleteComment = (documentId, commentId) => {\n      return new Promise((resolve, reject) => {\n        let comment = getAllAnnotations(documentId).filter(i => i.uuid === commentId)[0] || {};\n        if (!comment) {\n          return reject('Could not find annotation');\n        }\n        else if (!this._globalEdit && comment.userId && comment.userId !== this._userId) {\n          return reject('Non-matching userId');\n        }\n        let index = -1;\n        let annotations = getAnnotations(documentId, comment.userId);\n        for (let i = 0, l = annotations.length; i < l; i++) {\n          if (annotations[i].uuid === commentId) {\n            index = i;\n            break;\n          }\n        }\n\n        if (index > -1) {\n          annotations.splice(index, 1);\n          updateAnnotations(documentId, comment.userId, annotations);\n        }\n\n        resolve(true);\n      });\n    };\n  }\n\n  get userId() {\n    return this._userId;\n  }\n}\n\nfunction getAllAnnotations(documentId) {\n  let all_annotations = [];\n  let re = new RegExp(`${documentId}/(.*)/annotations`);\n  for (let i = 0; i < localStorage.length; i++) {\n    if (localStorage.key(i).search(re) > -1) {\n      all_annotations.push(...JSON.parse(localStorage.getItem(localStorage.key(i))));\n    }\n  }\n  return all_annotations;\n}\n\nfunction getAnnotations(documentId, userId) {\n  return JSON.parse(localStorage.getItem(`${documentId}/${userId}/annotations`)) || [];\n}\n\nfunction updateAnnotations(documentId, userId, annotations) {\n  localStorage.setItem(`${documentId}/${userId}/annotations`, JSON.stringify(annotations));\n}\n/**\n *\n * @param {String} documentId Document id of the annotation\n * @param {String} userId User id of the annotation\n * @param {String} annotationId The id of the annotation\n *\n * This function finds all the annotation made by one user.\n *\n * @return {int} The index of the annotation in localstorage\n */\nfunction findAnnotation(documentId, userId, annotationId) {\n  let index = -1;\n  let annotations = getAnnotations(documentId, userId);\n  for (let i = 0, l = annotations.length; i < l; i++) {\n    if (annotations[i].uuid === annotationId) {\n      index = i;\n      break;\n    }\n  }\n  return index;\n}\n","export default {\n  annotationLayerName: 'annotationLayer',\n  textLayerName: 'textLayer',\n  annotationSvgQuery: function() {\n    return 'svg.' + this.annotationLayerName;\n  },\n  annotationClassQuery: function() {\n    return '.' + this.annotationLayerName;\n  },\n  textClassQuery: function() {\n    return '.' + this.textLayerName;\n  }\n};\n","import PDFJSAnnotate from '../PDFJSAnnotate';\nimport config from '../config';\nimport {\n  addEventListener,\n  removeEventListener\n} from './event';\nimport {\n  BORDER_COLOR,\n  disableUserSelect,\n  enableUserSelect,\n  findSVGContainer,\n  findSVGAtPoint,\n  getOffsetAnnotationRect,\n  getMetadata,\n  convertToSvgPoint\n} from './utils';\n\nlet _enabled = false;\nlet isDragging = false;\nlet overlay;\nlet dragOffsetX, dragOffsetY, dragStartX, dragStartY;\nconst OVERLAY_BORDER_SIZE = 3;\n\n/**\n * Create an overlay for editing an annotation.\n *\n * @param {Element} target The annotation element to apply overlay for\n */\nfunction createEditOverlay(target) {\n  destroyEditOverlay();\n\n  overlay = document.createElement('div');\n  let anchor = document.createElement('a');\n  let parentNode = findSVGContainer(target).parentNode;\n  let id = target.getAttribute('data-pdf-annotate-id');\n  let rect = getOffsetAnnotationRect(target);\n  let styleLeft = rect.left - OVERLAY_BORDER_SIZE;\n  let styleTop = rect.top - OVERLAY_BORDER_SIZE;\n\n  overlay.setAttribute('id', 'pdf-annotate-edit-overlay');\n  overlay.setAttribute('data-target-id', id);\n  overlay.style.boxSizing = 'content-box';\n  overlay.style.position = 'absolute';\n  overlay.style.top = `${styleTop}px`;\n  overlay.style.left = `${styleLeft}px`;\n  overlay.style.width = `${rect.width}px`;\n  overlay.style.height = `${rect.height}px`;\n  overlay.style.border = `${OVERLAY_BORDER_SIZE}px solid ${BORDER_COLOR}`;\n  overlay.style.borderRadius = `${OVERLAY_BORDER_SIZE}px`;\n  overlay.style.zIndex = 20100;\n\n  anchor.innerHTML = '×';\n  anchor.setAttribute('href', 'javascript://');\n  anchor.style.background = '#fff';\n  anchor.style.borderRadius = '20px';\n  anchor.style.border = '1px solid #bbb';\n  anchor.style.color = '#bbb';\n  anchor.style.fontSize = '16px';\n  anchor.style.padding = '2px';\n  anchor.style.textAlign = 'center';\n  anchor.style.textDecoration = 'none';\n  anchor.style.position = 'absolute';\n  anchor.style.top = '-13px';\n  anchor.style.right = '-13px';\n  anchor.style.width = '25px';\n  anchor.style.height = '25px';\n\n  overlay.appendChild(anchor);\n  parentNode.appendChild(overlay);\n  document.addEventListener('click', handleDocumentClick);\n  document.addEventListener('keyup', handleDocumentKeyup);\n  document.addEventListener('mousedown', handleDocumentMousedown);\n  anchor.addEventListener('click', deleteAnnotation);\n  anchor.addEventListener('mouseover', () => {\n    anchor.style.color = '#35A4DC';\n    anchor.style.borderColor = '#999';\n    anchor.style.boxShadow = '0 1px 1px #ccc';\n  });\n  anchor.addEventListener('mouseout', () => {\n    anchor.style.color = '#bbb';\n    anchor.style.borderColor = '#bbb';\n    anchor.style.boxShadow = '';\n  });\n  overlay.addEventListener('mouseover', () => {\n    if (!isDragging) { anchor.style.display = ''; }\n  });\n  overlay.addEventListener('mouseout', () => {\n    anchor.style.display = 'none';\n  });\n}\n\n/**\n * Destroy the edit overlay if it exists.\n */\nfunction destroyEditOverlay() {\n  if (overlay) {\n    overlay.parentNode.removeChild(overlay);\n    overlay = null;\n  }\n\n  document.removeEventListener('click', handleDocumentClick);\n  document.removeEventListener('keyup', handleDocumentKeyup);\n  document.removeEventListener('mousedown', handleDocumentMousedown);\n  document.removeEventListener('mousemove', handleDocumentMousemove);\n  document.removeEventListener('mouseup', handleDocumentMouseup);\n  enableUserSelect();\n}\n\n/**\n * Delete currently selected annotation\n */\nfunction deleteAnnotation() {\n  if (!overlay) {\n    return;\n  }\n\n  let annotationId = overlay.getAttribute('data-target-id');\n  let svg = overlay.parentNode.querySelector(config.annotationSvgQuery());\n  let { documentId } = getMetadata(svg);\n\n  PDFJSAnnotate.getStoreAdapter().deleteAnnotation(documentId, annotationId).then(() => {\n    let nodes = document.querySelectorAll(`[data-pdf-annotate-id=\"${annotationId}\"]`);\n\n    [...nodes].forEach((n) => {\n      n.parentNode.removeChild(n);\n    });\n  });\n\n  destroyEditOverlay();\n}\n\n/**\n * Handle document.click event\n *\n * @param {Event} e The DOM event that needs to be handled\n */\nfunction handleDocumentClick(e) {\n  if (!findSVGAtPoint(e.clientX, e.clientY)) { return; }\n\n  // Remove current overlay\n  let overlay = document.getElementById('pdf-annotate-edit-overlay');\n  if (overlay) {\n    if (isDragging || e.target === overlay) {\n      return;\n    }\n\n    destroyEditOverlay();\n  }\n}\n\n/**\n * Handle document.keyup event\n *\n * @param {KeyboardEvent} e The DOM event that needs to be handled\n */\nfunction handleDocumentKeyup(e) {\n  // keyCode is deprecated, so prefer the newer \"key\" method if possible\n  let keyTest;\n  if (e.key) {\n    keyTest = e.key.toLowerCase() === 'delete' || e.key.toLowerCase() === 'backspace';\n  }\n  else {\n    keyTest = e.keyCode === 8 || e.keyCode === 46;\n  }\n  if (overlay && keyTest &&\n      e.target.nodeName.toLowerCase() !== 'textarea' &&\n      e.target.nodeName.toLowerCase() !== 'input') {\n    e.preventDefault();\n    deleteAnnotation();\n  }\n}\n\n/**\n * Handle document.mousedown event\n *\n * @param {Event} e The DOM event that needs to be handled\n */\nfunction handleDocumentMousedown(e) {\n  if (e.target !== overlay) {\n    return;\n  }\n\n  // Highlight and strikeout annotations are bound to text within the document.\n  // It doesn't make sense to allow repositioning these types of annotations.\n  let annotationId = overlay.getAttribute('data-target-id');\n  let target = document.querySelector(`[data-pdf-annotate-id=\"${annotationId}\"]`);\n  let type = target.getAttribute('data-pdf-annotate-type');\n\n  if (type === 'highlight' || type === 'strikeout') { return; }\n\n  isDragging = true;\n  dragOffsetX = e.clientX;\n  dragOffsetY = e.clientY;\n  dragStartX = overlay.offsetLeft;\n  dragStartY = overlay.offsetTop;\n\n  overlay.style.background = 'rgba(255, 255, 255, 0.7)';\n  overlay.style.cursor = 'move';\n  overlay.querySelector('a').style.display = 'none';\n\n  document.addEventListener('mousemove', handleDocumentMousemove);\n  document.addEventListener('mouseup', handleDocumentMouseup);\n  disableUserSelect();\n}\n\n/**\n * Handle document.mousemove event\n *\n * @param {Event} e The DOM event that needs to be handled\n */\nfunction handleDocumentMousemove(e) {\n  let parentNode = overlay.parentNode;\n  let rect = parentNode.getBoundingClientRect();\n  let y = (dragStartY + (e.clientY - dragOffsetY));\n  let x = (dragStartX + (e.clientX - dragOffsetX));\n  let minY = 0;\n  let maxY = rect.height;\n  let minX = 0;\n  let maxX = rect.width;\n\n  if (y > minY && y + overlay.offsetHeight < maxY) {\n    overlay.style.top = `${y}px`;\n  }\n\n  if (x > minX && x + overlay.offsetWidth < maxX) {\n    overlay.style.left = `${x}px`;\n  }\n}\n\n/**\n * Handle document.mouseup event\n *\n * @param {Event} e The DOM event that needs to be handled\n */\nfunction handleDocumentMouseup(e) {\n  let annotationId = overlay.getAttribute('data-target-id');\n  let target = document.querySelectorAll(`[data-pdf-annotate-id=\"${annotationId}\"]`);\n  let type = target[0].getAttribute('data-pdf-annotate-type');\n  let svg = overlay.parentNode.querySelector(config.annotationSvgQuery());\n  let { documentId } = getMetadata(svg);\n\n  overlay.querySelector('a').style.display = '';\n\n  PDFJSAnnotate.getStoreAdapter().getAnnotation(documentId, annotationId).then((annotation) => {\n    let attribX = 'x';\n    let attribY = 'y';\n    if (['circle', 'fillcircle', 'emptycircle'].indexOf(type) > -1) {\n      attribX = 'cx';\n      attribY = 'cy';\n    }\n\n    if (type === 'point') {\n      // Broken\n      /*\n      [...target].forEach((t, i) => {\n        let moveTo = {\n          x: overlay.offsetLeft + 3,\n          y: overlay.offsetTop + 3\n        };\n        t.setAttribute(attribX, moveTo.x);\n        t.setAttribute(attribY, moveTo.y);\n        annotation[attribX] = moveTo.x;\n        annotation[attribY] = moveTo.y;\n      });\n      */\n      return;\n    }\n    else if (['area', 'highlight', 'textbox', 'circle', 'fillcircle', 'emptycircle'].indexOf(type) > -1) {\n      let modelStart = convertToSvgPoint([dragStartX, dragStartY], svg);\n      let modelEnd = convertToSvgPoint([overlay.offsetLeft, overlay.offsetTop], svg);\n      let modelDelta = {\n        x: modelEnd[0] - modelStart[0],\n        y: modelEnd[1] - modelStart[1]\n      };\n\n      if (type === 'textbox') {\n        target = [target[0].firstChild];\n      }\n\n      [...target].forEach((t, i) => {\n        let modelX = parseInt(t.getAttribute(attribX), 10);\n        let modelY = parseInt(t.getAttribute(attribY), 10);\n        if (modelDelta.y !== 0) {\n          modelY = modelY + modelDelta.y;\n\n          t.setAttribute(attribY, modelY);\n          if (annotation.rectangles && i < annotation.rectangles.length) {\n            annotation.rectangles[i].y = modelY;\n          }\n          else if (annotation[attribY]) {\n            annotation[attribY] = modelY;\n          }\n        }\n        if (modelDelta.x !== 0) {\n          modelX = modelX + modelDelta.x;\n\n          t.setAttribute(attribX, modelX);\n          if (annotation.rectangles && i < annotation.rectangles.length) {\n            annotation.rectangles[i].x = modelX;\n          }\n          else if (annotation[attribX]) {\n            annotation[attribX] = modelX;\n          }\n        }\n      });\n    }\n    else if (type === 'strikeout') {\n      return;\n    //   let { deltaX, deltaY } = getDelta('x1', 'y1');\n    //   [...target].forEach(target, (t, i) => {\n    //     if (deltaY !== 0) {\n    //       t.setAttribute('y1', parseInt(t.getAttribute('y1'), 10) + deltaY);\n    //       t.setAttribute('y2', parseInt(t.getAttribute('y2'), 10) + deltaY);\n    //       annotation.rectangles[i].y = parseInt(t.getAttribute('y1'), 10);\n    //     }\n    //     if (deltaX !== 0) {\n    //       t.setAttribute('x1', parseInt(t.getAttribute('x1'), 10) + deltaX);\n    //       t.setAttribute('x2', parseInt(t.getAttribute('x2'), 10) + deltaX);\n    //       annotation.rectangles[i].x = parseInt(t.getAttribute('x1'), 10);\n    //     }\n    //   });\n    }\n    else if (type === 'drawing' || type === 'arrow') {\n      // Do nothing as currently broken\n      /*\n      let modelStart = convertToSvgPoint([dragStartX, dragStartY], svg);\n      let modelEnd = convertToSvgPoint([overlay.offsetLeft, overlay.offsetTop], svg);\n      let modelDelta = {\n        x: modelEnd[0] - modelStart[0],\n        y: modelEnd[1] - modelStart[1]\n      };\n\n      annotation.lines.forEach((line, i) => {\n        let [x, y] = annotation.lines[i];\n        annotation.lines[i][0] = x + modelDelta.x;\n        annotation.lines[i][1] = y + modelDelta.y;\n      });\n\n      target[0].parentNode.removeChild(target[0]);\n      appendChild(svg, annotation);\n      */\n      return;\n    }\n\n    PDFJSAnnotate.getStoreAdapter().editAnnotation(documentId, annotationId, annotation);\n  });\n\n  setTimeout(() => {\n    isDragging = false;\n  }, 0);\n\n  overlay.style.background = '';\n  overlay.style.cursor = '';\n\n  document.removeEventListener('mousemove', handleDocumentMousemove);\n  document.removeEventListener('mouseup', handleDocumentMouseup);\n  enableUserSelect();\n}\n\n/**\n * Handle annotation.click event\n *\n * @param {Element} e The annotation element that was clicked\n */\nfunction handleAnnotationClick(target) {\n  createEditOverlay(target);\n}\n\n/**\n * Enable edit mode behavior.\n */\nexport function enableEdit() {\n  if (_enabled) {\n    return;\n  }\n\n  _enabled = true;\n  addEventListener('annotation:click', handleAnnotationClick);\n};\n\n/**\n * Disable edit mode behavior.\n */\nexport function disableEdit() {\n  destroyEditOverlay();\n\n  if (!_enabled) {\n    return;\n  }\n\n  _enabled = false;\n  removeEventListener('annotation:click', handleAnnotationClick);\n};\n\n","import PDFJSAnnotate from '../PDFJSAnnotate';\nimport { appendChild } from '../render/appendChild';\nimport {\n  disableUserSelect,\n  enableUserSelect,\n  findSVGAtPoint,\n  getMetadata,\n  convertToSvgPoint\n} from './utils';\n\nlet _enabled = false;\nlet _candraw = false;\nlet _penSize;\nlet _penColor;\nlet path;\nlet lines = [];\n\n/**\n * Handle document.touchdown or document.pointerdown event\n * @param {PointerEvent} e The DOM event to be handled\n */\nfunction handleDocumentPointerdown(e) {\n  path = null;\n  lines = [];\n  if (!findSVGAtPoint(e.clientX, e.clientY)) {\n    return;\n  }\n  _candraw = true;\n  e.preventDefault();\n}\n\n/**\n * Handle document.pointerup event\n *\n * @param {PointerEvent} e The DOM event to be handled\n */\nfunction handleDocumentPointerup(e) {\n  saveToStorage(e.clientX, e.clientY);\n}\n\nfunction saveToStorage(x, y) {\n  if (!_candraw) {\n    return;\n  }\n  _candraw = false;\n  let svg;\n  if (lines.length > 1 && (svg = findSVGAtPoint(x, y))) {\n    let { documentId, pageNumber } = getMetadata(svg);\n    PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, pageNumber, {\n      type: 'drawing',\n      width: _penSize,\n      color: _penColor,\n      lines\n    }).then((annotation) => {\n      if (path) {\n        svg.removeChild(path);\n      }\n\n      appendChild(svg, annotation);\n    });\n  }\n}\n\n/**\n * Handle document.mousemove event\n *\n * @param {PointerEvent} e The DOM event to be handled\n */\nfunction handleDocumentPointermove(e) {\n  if (!findSVGAtPoint(e.clientX, e.clientY) || !_candraw) {\n    return;\n  }\n  savePoint(e.clientX, e.clientY);\n}\n\n/**\n * Handle document.keyup event\n *\n * @param {KeyboardEvent} e The DOM event to be handled\n * } e The DOM event to be handled\n */\nfunction handleDocumentKeyup(e) {\n  // Cancel rect if Esc is pressed\n  if (e.keyCode === 27) {\n    lines = null;\n    path.parentNode.removeChild(path);\n    document.removeEventListener('pointermove', handleDocumentPointermove);\n    document.removeEventListener('pointerup', handleDocumentPointerup);\n  }\n}\n\n/**\n * Save a point to the line being drawn.\n *\n * @param {Number} x The x coordinate of the point\n * @param {Number} y The y coordinate of the point\n */\nfunction savePoint(x, y) {\n  let svg = findSVGAtPoint(x, y);\n  if (!svg) {\n    return;\n  }\n\n  let rect = svg.getBoundingClientRect();\n  let point = convertToSvgPoint([\n    x - rect.left,\n    y - rect.top\n  ], svg);\n  point[0] = point[0].toFixed(2);\n  point[1] = point[1].toFixed(2);\n  lines.push(point);\n\n  if (lines.length <= 1) {\n    return;\n  }\n\n  if (path) {\n    svg.removeChild(path);\n  }\n\n  path = appendChild(svg, {\n    type: 'drawing',\n    color: _penColor,\n    width: _penSize,\n    lines\n  });\n}\n\n/**\n * Set the attributes of the pen.\n *\n * @param {Number} penSize The size of the lines drawn by the pen, rounded to 2 decimal places\n * @param {String} penColor The color of the lines drawn by the pen\n */\nexport function setPen(penSize = 1, penColor = '000000') {\n  _penSize = Math.round(parseFloat(penSize) * 1e2) / 1e2;\n  _penColor = penColor;\n}\n\n/**\n * Return pen attributes of the pen\n *\n * @return {Object} Object with size and color\n */\nexport function getPen() {\n  return {\n    size: _penSize,\n    color: _penColor\n  };\n}\n\n/**\n * Enable the pen behavior\n */\nexport function enablePen() {\n  if (_enabled) {\n    return;\n  }\n\n  _enabled = true;\n  // Chrome and Firefox has different behaviors with how pen works, so we need different events.\n  document.addEventListener('pointerdown', handleDocumentPointerdown);\n  document.addEventListener('pointermove', handleDocumentPointermove);\n  document.addEventListener('pointerup', handleDocumentPointerup);\n\n  document.addEventListener('keyup', handleDocumentKeyup);\n  disableUserSelect();\n}\n\n/**\n * Disable the pen behavior\n */\nexport function disablePen() {\n  if (!_enabled) {\n    return;\n  }\n\n  _enabled = false;\n  document.removeEventListener('pointerdown', handleDocumentPointerdown);\n  document.removeEventListener('pointermove', handleDocumentPointermove);\n  document.removeEventListener('pointerup', handleDocumentPointerup);\n\n  document.removeEventListener('keyup', handleDocumentKeyup);\n  enableUserSelect();\n}\n","import PDFJSAnnotate from '../PDFJSAnnotate';\nimport { appendChild } from '../render/appendChild';\nimport {\n  disableUserSelect,\n  enableUserSelect,\n  findSVGAtPoint,\n  findSVGContainer,\n  getMetadata,\n  convertToSvgPoint,\n  convertToScreenPoint,\n  findAnnotationAtPoint\n} from './utils';\n\nlet _enabled = false;\nlet _penSize;\nlet _penColor;\nlet path;\nlet lines;\nlet originY;\nlet originX;\n\n/**\n * Handle document.mousedown event\n */\nfunction handleDocumentMousedown(e) {\n  let target = findAnnotationAtPoint(e.clientX, e.clientY);\n  if (target === null) {\n    return;\n  }\n\n  let type = target.getAttribute('data-pdf-annotate-type');\n  if (type !== 'circle' && type !== 'fillcircle' && type !== 'emptycircle') {\n    return;\n  }\n\n  let svg = findSVGContainer(target);\n  let { documentId } = getMetadata(svg);\n  let annotationId = target.getAttribute('data-pdf-annotate-id');\n\n  PDFJSAnnotate.getStoreAdapter().getAnnotation(documentId, annotationId).then((annotation) => {\n    if (annotation) {\n      path = null;\n      lines = [];\n\n      let point = convertToScreenPoint([\n        annotation.cx,\n        annotation.cy\n      ], svg);\n\n      let rect = svg.getBoundingClientRect();\n\n      originX = point[0] + rect.left;\n      originY = point[1] + rect.top;\n\n      document.addEventListener('mousemove', handleDocumentMousemove);\n      document.addEventListener('mouseup', handleDocumentMouseup);\n    }\n  });\n}\n\n/**\n * Handle document.mouseup event\n *\n * @param {Event} e The DOM event to be handled\n */\nfunction handleDocumentMouseup(e) {\n  let svg;\n  if (lines.length > 1 && (svg = findSVGAtPoint(e.clientX, e.clientY))) {\n    let { documentId, pageNumber } = getMetadata(svg);\n\n    PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, pageNumber, {\n      type: 'arrow',\n      width: _penSize,\n      color: _penColor,\n      lines\n    }).then((annotation) => {\n      if (path) {\n        svg.removeChild(path);\n      }\n\n      appendChild(svg, annotation);\n    });\n  }\n\n  document.removeEventListener('mousemove', handleDocumentMousemove);\n  document.removeEventListener('mouseup', handleDocumentMouseup);\n}\n\n/**\n * Handle document.mousemove event\n *\n * @param {Event} e The DOM event to be handled\n */\nfunction handleDocumentMousemove(e) {\n  let x = lines.length === 0 ? originX : e.clientX;\n  let y = lines.length === 0 ? originY : e.clientY;\n\n  savePoint(x, y);\n}\n\n/**\n * Handle document.keyup event\n *\n * @param {Event} e The DOM event to be handled\n */\nfunction handleDocumentKeyup(e) {\n  // Cancel rect if Esc is pressed\n  if (e.keyCode === 27) {\n    lines = null;\n    path.parentNode.removeChild(path);\n    document.removeEventListener('mousemove', handleDocumentMousemove);\n    document.removeEventListener('mouseup', handleDocumentMouseup);\n  }\n}\n\n/**\n * Save a point to the line being drawn.\n *\n * @param {Number} x The x coordinate of the point\n * @param {Number} y The y coordinate of the point\n */\nfunction savePoint(x, y) {\n  let svg = findSVGAtPoint(x, y);\n  if (!svg) {\n    return;\n  }\n\n  let rect = svg.getBoundingClientRect();\n  let point = convertToSvgPoint([\n    x - rect.left,\n    y - rect.top\n  ], svg);\n\n  if (lines.length < 2) {\n    lines.push(point);\n    return;\n  }\n  else {\n    lines[1] = point; // update end point\n  }\n\n  if (path) {\n    svg.removeChild(path);\n  }\n\n  path = appendChild(svg, {\n    type: 'arrow',\n    color: _penColor,\n    width: _penSize,\n    lines\n  });\n}\n\n/**\n * Set the attributes of the pen.\n *\n * @param {Number} penSize The size of the lines drawn by the pen\n * @param {String} penColor The color of the lines drawn by the pen\n */\nexport function setArrow(penSize = 10, penColor = '0000FF') {\n  _penSize = parseInt(penSize, 10);\n  _penColor = penColor;\n}\n\n/**\n * Enable the pen behavior\n */\nexport function enableArrow() {\n  if (_enabled) { return; }\n\n  _enabled = true;\n  document.addEventListener('mousedown', handleDocumentMousedown);\n  document.addEventListener('keyup', handleDocumentKeyup);\n  disableUserSelect();\n}\n\n/**\n * Disable the pen behavior\n */\nexport function disableArrow() {\n  if (!_enabled) { return; }\n\n  _enabled = false;\n  document.removeEventListener('mousedown', handleDocumentMousedown);\n  document.removeEventListener('keyup', handleDocumentKeyup);\n  enableUserSelect();\n}\n\n","import PDFJSAnnotate from '../PDFJSAnnotate';\nimport {\n  findAnnotationAtPoint,\n  getMetadata\n} from './utils';\n\nlet _canerase = false;\nlet previousPoint = null;\n\n/**\n *\n * @param {PointerEvent} e DOM event to handle\n */\nfunction handleDocumentDown(e) {\n  _canerase = true;\n  previousPoint = [e.clientX, e.clientY];\n}\n\n/**\n *\n * @param {PointerEvent} e DOM event to handle\n */\nfunction handleDocumentUp(e) {\n  _canerase = false;\n  erase(findAnnotationAtPoint(e.clientX, e.clientY));\n}\n\n/**\n *\n * @param {PointerEvent} e DOM event to handle\n */\nfunction handleDocumentMouseMove(e) {\n  if (!_canerase) {\n    return;\n  }\n\n  // This algorithm attempts to get the various points between the last\n  // PointerEvent and this one\n  let check = [];\n  let diffX = Math.abs(previousPoint[0] - e.clientX);\n  let diffY = Math.abs(previousPoint[1] - e.clientY);\n  if (diffX >= 1 || diffY >= 1) {\n    let maxSteps = Math.round(Math.max(diffX, diffY));\n    let subStepSize = Math.min(diffX, diffY) / maxSteps;\n    let smallerTest = diffX < diffY;\n    let startPoint = [\n      Math.min(previousPoint[0], e.clientX),\n      Math.min(previousPoint[1], e.clientY)\n    ];\n    for (let i = 0; i < maxSteps; i++) {\n      if (smallerTest) {\n        check.push([Math.round(startPoint[0] + (subStepSize * i)), Math.round(startPoint[1] + i)]);\n      }\n      else {\n        check.push([Math.round(startPoint[0] + i), Math.round(startPoint[1] + (subStepSize * i))]);\n      }\n    }\n  }\n  for (let point of check) {\n    erase(findAnnotationAtPoint(point[0], point[1]));\n  }\n  previousPoint = [e.clientX, e.clientY];\n}\n\nfunction erase(target) {\n  if (!_canerase) {\n    return;\n  }\n\n  if (target) {\n    let { documentId } = getMetadata(target.parentElement);\n    let annotationId = target.getAttribute('data-pdf-annotate-id');\n    PDFJSAnnotate.getStoreAdapter().deleteAnnotation(documentId, annotationId).then(() => {\n      let nodes = document.querySelectorAll(`[data-pdf-annotate-id=\"${annotationId}\"]`);\n      [...nodes].forEach((n) => {\n        n.parentNode.removeChild(n);\n      });\n    });\n  }\n}\n\nexport function enableEraser() {\n  document.addEventListener('pointermove', handleDocumentMouseMove);\n  document.addEventListener('pointerdown', handleDocumentDown);\n  document.addEventListener('pointerup', handleDocumentUp);\n}\n\nexport function disableEraser() {\n  document.removeEventListener('pointermove', handleDocumentMouseMove);\n  document.removeEventListener('pointerdown', handleDocumentDown);\n  document.removeEventListener('pointerup', handleDocumentUp);\n}\n","import PDFJSAnnotate from '../PDFJSAnnotate';\nimport { appendChild } from '../render/appendChild';\nimport {\n  BORDER_COLOR,\n  findSVGAtPoint,\n  getMetadata,\n  scaleDown\n} from './utils';\n\nlet _enabled = false;\nlet input;\n\n/**\n * Handle document.mouseup event\n *\n * @param {Event} The DOM event to be handled\n */\nfunction handleDocumentMouseup(e) {\n  if (input || !findSVGAtPoint(e.clientX, e.clientY)) {\n    return;\n  }\n\n  input = document.createElement('input');\n  input.setAttribute('id', 'pdf-annotate-point-input');\n  input.setAttribute('placeholder', 'Enter comment');\n  input.style.border = `3px solid ${BORDER_COLOR}`;\n  input.style.borderRadius = '3px';\n  input.style.position = 'absolute';\n  input.style.top = `${e.clientY}px`;\n  input.style.left = `${e.clientX}px`;\n\n  input.addEventListener('blur', handleInputBlur);\n  input.addEventListener('keyup', handleInputKeyup);\n\n  document.body.appendChild(input);\n  input.focus();\n}\n\n/**\n * Handle input.blur event\n */\nfunction handleInputBlur() {\n  savePoint();\n}\n\n/**\n * Handle input.keyup event\n *\n * @param {Event} e The DOM event to handle\n */\nfunction handleInputKeyup(e) {\n  if (e.keyCode === 27) {\n    closeInput();\n  }\n  else if (e.keyCode === 13) {\n    savePoint();\n  }\n}\n\n/**\n * Save a new point annotation from input\n */\nfunction savePoint() {\n  if (input.value.trim().length > 0) {\n    let clientX = parseInt(input.style.left, 10);\n    let clientY = parseInt(input.style.top, 10);\n    let content = input.value.trim();\n    let svg = findSVGAtPoint(clientX, clientY);\n    if (!svg) {\n      return;\n    }\n\n    let rect = svg.getBoundingClientRect();\n    let { documentId, pageNumber } = getMetadata(svg);\n    let annotation = Object.assign({\n      type: 'point'\n    }, scaleDown(svg, {\n      x: clientX - rect.left,\n      y: clientY - rect.top\n    }));\n\n    PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, pageNumber, annotation)\n      .then((annotation) => {\n        PDFJSAnnotate.getStoreAdapter().addComment(\n          documentId,\n          annotation.uuid,\n          content\n        );\n\n        appendChild(svg, annotation);\n      });\n  }\n\n  closeInput();\n}\n\n/**\n * Close the input element\n */\nfunction closeInput() {\n  input.removeEventListener('blur', handleInputBlur);\n  input.removeEventListener('keyup', handleInputKeyup);\n  document.body.removeChild(input);\n  input = null;\n}\n\n/**\n * Enable point annotation behavior\n */\nexport function enablePoint() {\n  if (_enabled) { return; }\n\n  _enabled = true;\n  document.addEventListener('mouseup', handleDocumentMouseup);\n}\n\n/**\n * Disable point annotation behavior\n */\nexport function disablePoint() {\n  if (!_enabled) { return; }\n\n  _enabled = false;\n  document.removeEventListener('mouseup', handleDocumentMouseup);\n}\n\n","import PDFJSAnnotate from '../PDFJSAnnotate';\nimport config from '../config';\nimport { appendChild } from '../render/appendChild';\nimport {\n  BORDER_COLOR,\n  disableUserSelect,\n  enableUserSelect,\n  findSVGAtPoint,\n  getMetadata,\n  convertToSvgRect\n} from './utils';\n\nlet _enabled = false;\nlet _type;\nlet overlay;\nlet originY;\nlet originX;\n\n/**\n * Get the current window selection as rects\n *\n * @return {Array} An Array of rects\n */\nfunction getSelectionRects() {\n  try {\n    let selection = window.getSelection();\n    let range = selection.getRangeAt(0);\n    let rects = range.getClientRects();\n\n    if (rects.length > 0 &&\n        rects[0].width > 0 &&\n        rects[0].height > 0) {\n      return rects;\n    }\n  }\n  catch (e) {}\n\n  return null;\n}\n\n/**\n * Handle document.mousedown event\n *\n * @param {Event} e The DOM event to handle\n */\nfunction handleDocumentMousedown(e) {\n  let svg;\n  if (_type !== 'area' || !(svg = findSVGAtPoint(e.clientX, e.clientY))) {\n    return;\n  }\n\n  let rect = svg.getBoundingClientRect();\n  originY = e.clientY;\n  originX = e.clientX;\n\n  overlay = document.createElement('div');\n  overlay.style.position = 'absolute';\n  overlay.style.top = `${originY - rect.top}px`;\n  overlay.style.left = `${originX - rect.left}px`;\n  overlay.style.border = `3px solid ${BORDER_COLOR}`;\n  overlay.style.borderRadius = '3px';\n  svg.parentNode.appendChild(overlay);\n\n  document.addEventListener('mousemove', handleDocumentMousemove);\n  disableUserSelect();\n}\n\n/**\n * Handle document.mousemove event\n *\n * @param {Event} e The DOM event to handle\n */\nfunction handleDocumentMousemove(e) {\n  let svg = overlay.parentNode.querySelector(config.annotationSvgQuery());\n  let rect = svg.getBoundingClientRect();\n\n  if (originX + (e.clientX - originX) < rect.right) {\n    overlay.style.width = `${e.clientX - originX}px`;\n  }\n\n  if (originY + (e.clientY - originY) < rect.bottom) {\n    overlay.style.height = `${e.clientY - originY}px`;\n  }\n}\n\n/**\n * Handle document.mouseup event\n *\n * @param {Event} e The DOM event to handle\n */\nfunction handleDocumentMouseup(e) {\n  let rects;\n  if (_type !== 'area' && (rects = getSelectionRects())) {\n    saveRect(_type, [...rects].map((r) => {\n      return {\n        top: r.top,\n        left: r.left,\n        width: r.width,\n        height: r.height\n      };\n    }));\n  }\n  else if (_type === 'area' && overlay) {\n    let svg = overlay.parentNode.querySelector(config.annotationSvgQuery());\n    let rect = svg.getBoundingClientRect();\n    saveRect(_type, [{\n      top: parseInt(overlay.style.top, 10) + rect.top,\n      left: parseInt(overlay.style.left, 10) + rect.left,\n      width: parseInt(overlay.style.width, 10),\n      height: parseInt(overlay.style.height, 10)\n    }]);\n\n    overlay.parentNode.removeChild(overlay);\n    overlay = null;\n\n    document.removeEventListener('mousemove', handleDocumentMousemove);\n    enableUserSelect();\n  }\n}\n\n/**\n * Handle document.keyup event\n *\n * @param {Event} e The DOM event to handle\n */\nfunction handleDocumentKeyup(e) {\n  // Cancel rect if Esc is pressed\n  if (e.keyCode === 27) {\n    let selection = window.getSelection();\n    selection.removeAllRanges();\n    if (overlay && overlay.parentNode) {\n      overlay.parentNode.removeChild(overlay);\n      overlay = null;\n      document.removeEventListener('mousemove', handleDocumentMousemove);\n    }\n  }\n}\n\n/**\n * Save a rect annotation\n *\n * @param {String} type The type of rect (area, highlight, strikeout)\n * @param {Array} rects The rects to use for annotation\n * @param {String} color The color of the rects\n */\nfunction saveRect(type, rects, color) {\n  let svg = findSVGAtPoint(rects[0].left, rects[0].top);\n  let annotation;\n\n  if (!svg) {\n    return;\n  }\n\n  let boundingRect = svg.getBoundingClientRect();\n\n  if (!color) {\n    if (type === 'highlight') {\n      color = 'FFFF00';\n    }\n    else if (type === 'strikeout') {\n      color = 'FF0000';\n    }\n  }\n\n  // Initialize the annotation\n  annotation = {\n    type,\n    color,\n    rectangles: [...rects].map((r) => {\n      let offset = 0;\n\n      if (type === 'strikeout') {\n        offset = r.height / 2;\n      }\n\n      return convertToSvgRect({\n        y: (r.top + offset) - boundingRect.top,\n        x: r.left - boundingRect.left,\n        width: r.width,\n        height: r.height\n      }, svg);\n    }).filter((r) => r.width > 0 && r.height > 0 && r.x > -1 && r.y > -1)\n  };\n\n  // Short circuit if no rectangles exist\n  if (annotation.rectangles.length === 0) {\n    return;\n  }\n\n  // Special treatment for area as it only supports a single rect\n  if (type === 'area') {\n    let rect = annotation.rectangles[0];\n    delete annotation.rectangles;\n    annotation.x = rect.x;\n    annotation.y = rect.y;\n    annotation.width = rect.width;\n    annotation.height = rect.height;\n  }\n\n  let { documentId, pageNumber } = getMetadata(svg);\n\n  // Add the annotation\n  PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, pageNumber, annotation)\n    .then((annotation) => {\n      appendChild(svg, annotation);\n    });\n}\n\n/**\n * Enable rect behavior\n */\nexport function enableRect(type) {\n  _type = type;\n\n  if (_enabled) { return; }\n\n  _enabled = true;\n  document.addEventListener('mouseup', handleDocumentMouseup);\n  document.addEventListener('mousedown', handleDocumentMousedown);\n  document.addEventListener('keyup', handleDocumentKeyup);\n}\n\n/**\n * Disable rect behavior\n */\nexport function disableRect() {\n  if (!_enabled) { return; }\n\n  _enabled = false;\n  document.removeEventListener('mouseup', handleDocumentMouseup);\n  document.removeEventListener('mousedown', handleDocumentMousedown);\n  document.removeEventListener('keyup', handleDocumentKeyup);\n}\n\n","import PDFJSAnnotate from \"../PDFJSAnnotate\";\nimport { appendChild } from \"../render/appendChild\";\nimport { findSVGAtPoint, getMetadata, convertToSvgPoint } from \"./utils\";\n\nlet _enabled = false;\nlet _type;\nlet _width = 100;\nlet _height = 30;\nlet _color = \"F9FAC3\";\n\n/**\n * Set the attributes of the pen.\n *\n * @param {Number} width The radius of the circle\n * @param {String} color The color of the circle\n */\nexport function setSignatureBlock(width = 100, color = \"F9FAC3\") {\n  _width = parseInt(width, 10);\n  _color = color;\n}\n\n/**\n * Handle document.mouseup event\n *\n * @param {Event} e The DOM event to handle\n */\nfunction handleDocumentMouseup(e) {\n  let svg = findSVGAtPoint(e.clientX, e.clientY);\n  if (!svg) {\n    return;\n  }\n  let rect = svg.getBoundingClientRect();\n\n  saveSignatureBlock(\n    svg,\n    _type,\n    {\n      x: e.clientX - rect.left,\n      y: e.clientY - rect.top,\n    },\n    _width,\n    _height,\n    _color\n  );\n}\n\n/**\n * Save a signature annotation\n *\n * @param {SVGElement} svg\n * @param {String} type The type of signature block (signature)\n * @param {Object} pt The point to use for annotation\n * @param {float} width\n * * @param {float} height\n * @param {String} color The color of the rects\n */\nfunction saveSignatureBlock(svg, type, pt, width, height, color) {\n  // Initialize the annotation\n  let svg_pt = convertToSvgPoint([pt.x, pt.y], svg);\n  let annotation = {\n    type,\n    color,\n    cx: svg_pt[0],\n    cy: svg_pt[1],\n    w: width,\n    h: height,\n  };\n\n  let { documentId, pageNumber } = getMetadata(svg);\n\n  const event = new CustomEvent(\"addAnnotation\", {\n    detail: {\n      page: pageNumber,\n      type: type,\n      color: color,\n      cx: svg_pt[0],\n      cy: svg_pt[1],\n      w: width,\n      h: height,\n    },\n  });\n\n  document.dispatchEvent(event);\n\n  // Add the annotation\n  PDFJSAnnotate.getStoreAdapter()\n    .addAnnotation(documentId, pageNumber, annotation)\n    .then((annotation) => {\n      appendChild(svg, annotation);\n    });\n}\n\n/**\n * Enable signature block behavior\n */\nexport function enableSignatureBlock(type) {\n  _type = type;\n\n  if (_enabled) {\n    return;\n  }\n\n  _enabled = true;\n  document.addEventListener(\"mouseup\", handleDocumentMouseup);\n}\n\n/**\n * Disable signature block behavior\n */\nexport function disableSignatureBlock() {\n  if (!_enabled) {\n    return;\n  }\n\n  _enabled = false;\n  document.removeEventListener(\"mouseup\", handleDocumentMouseup);\n}\n\nexport function addSignatureBlock(type, e) {\n  let oldType = _type;\n  _type = type;\n  handleDocumentMouseup(e);\n  _type = oldType;\n}\n","import PDFJSAnnotate from \"../PDFJSAnnotate\";\nimport { appendChild } from \"../render/appendChild\";\nimport {\n  BORDER_COLOR,\n  findSVGAtPoint,\n  getMetadata,\n  convertToSvgPoint,\n} from \"./utils\";\n\nlet _enabled = false;\nlet input;\nlet _textSize = localStorage.getItem(`text/size`) || 12;\nlet _textColor = localStorage.getItem(`text/color`) || \"#000000\";\n\n/**\n * Handle document.mouseup event\n *\n * @param {Event} e The DOM event to handle\n */\nfunction handleDocumentMouseup(e) {\n  if (input || !findSVGAtPoint(e.clientX, e.clientY)) {\n    return;\n  }\n  if (!e.srcElement.classList.contains(\"annotationLayer\")) {\n    return;\n  }\n  input = document.createElement(\"textarea\");\n  input.setAttribute(\"id\", \"pdf-annotate-text-input\");\n  input.setAttribute(\"placeholder\", \"Enter text... SHIFT + ENTER for new line\");\n  input.style.border = `3px solid ${BORDER_COLOR}`;\n  input.style.borderRadius = \"3px\";\n  input.style.position = \"fixed\";\n  input.style.top = `${e.clientY}px`;\n  input.style.left = `${e.clientX}px`;\n  input.style.fontSize = `${_textSize}px`;\n  input.style.zIndex = \"41\";\n  input.addEventListener(\"blur\", handleInputBlur);\n  input.addEventListener(\"keyup\", handleInputKeyup);\n\n  document.body.appendChild(input);\n  input.focus();\n}\n\n/**\n * Handle input.blur event\n */\nfunction handleInputBlur() {\n  saveText();\n}\n\n/**\n * Handle input.keyup event\n *\n * @param {Event} e The DOM event to handle\n */\nfunction handleInputKeyup(e) {\n  if (e.keyCode === 27) {\n    closeInput();\n  } else if (e.keyCode === 13 && !e.shiftKey) {\n    saveText();\n  }\n}\n\n/**\n * Save a text annotation from input\n */\nfunction saveText() {\n  let value = input.value ? input.value.replace(/ +$/, \"\") : \"\";\n  if (value.length > 0) {\n    let clientX = parseInt(input.style.left, 10);\n    let clientY = parseInt(input.style.top, 10);\n    let svg = findSVGAtPoint(clientX, clientY);\n    if (!svg) {\n      return;\n    }\n    let height = _textSize;\n    let { documentId, pageNumber, viewport } = getMetadata(svg);\n    let scale = 1 / viewport.scale;\n    let rect = svg.getBoundingClientRect();\n    let pt = convertToSvgPoint(\n      [clientX - rect.left, clientY - rect.top + height],\n      svg,\n      viewport\n    );\n    let annotation = {\n      type: \"textbox\",\n      size: _textSize * scale,\n      color: _textColor,\n      content: value,\n      x: pt[0],\n      y: pt[1],\n      rotation: -viewport.rotation,\n    };\n\n    const event = new CustomEvent(\"addAnnotation\", {\n      detail: {\n        page: pageNumber,\n        type: \"textbox\",\n        size: _textSize * scale,\n        color: _textColor,\n        content: value,\n        x: pt[0],\n        y: pt[1],\n        rotation: -viewport.rotation,\n      },\n    });\n\n    PDFJSAnnotate.getStoreAdapter()\n      .addAnnotation(documentId, pageNumber, annotation)\n      .then((annotation) => {\n        appendChild(svg, annotation);\n      });\n\n    document.dispatchEvent(event);\n  }\n\n  closeInput();\n}\n\n/**\n * Close the input\n */\nfunction closeInput() {\n  if (input) {\n    input.removeEventListener(\"blur\", handleInputBlur);\n    input.removeEventListener(\"keyup\", handleInputKeyup);\n    document.body.removeChild(input);\n    input = null;\n  }\n}\n\n/**\n * Set the text attributes\n *\n * @param {Number} textSize The size of the text\n * @param {String} textColor The color of the text\n */\nexport function setText(textSize = 12, textColor = \"000000\") {\n  _textSize = parseInt(textSize, 10);\n  _textColor = textColor;\n}\n\n/**\n * Enable text behavior\n */\nexport function enableText() {\n  if (_enabled) {\n    return;\n  }\n\n  _enabled = true;\n  document.addEventListener(\"mouseup\", handleDocumentMouseup);\n}\n\n/**\n * Disable text behavior\n */\nexport function disableText() {\n  if (!_enabled) {\n    return;\n  }\n\n  _enabled = false;\n  document.removeEventListener(\"mouseup\", handleDocumentMouseup);\n}\n","/**\n * Create a node that is only visible to screen readers\n *\n * @param {String} content The text content that should be read by screen reader\n * @param {String} [annotationId] The ID of the annotation assocaited\n * @return {Element} An Element that is only visible to screen readers\n */\nexport default function createScreenReaderOnly(content, annotationId) {\n  let node = document.createElement('div');\n  let text = document.createTextNode(content);\n  node.appendChild(text);\n  node.setAttribute('id', `pdf-annotate-screenreader-${annotationId}`);\n  node.style.position = 'absolute';\n  node.style.left = '-10000px';\n  node.style.top = 'auto';\n  node.style.width = '1px';\n  node.style.height = '1px';\n  node.style.overflow = 'hidden';\n  return node;\n}\n","import config from '../config';\nimport {\n  pointIntersectsRect,\n  scaleUp,\n  scaleDown\n} from '../UI/utils';\n\n/**\n * Insert an element at a point within the document.\n * This algorithm will only insert within an element amidst it's text content.\n *\n * @param {Element} el The element to be inserted\n * @param {Number} x The x coordinate of the point\n * @param {Number} y The y coordinate of the point\n * @param {Number} pageNumber The page number to limit elements to\n * @param {Boolean} insertBefore Whether the element is to be inserted before or after x\n * @return {Boolean} True if element was able to be inserted, otherwise false\n */\nexport default function insertElementWithinElement(el, x, y, pageNumber, insertBefore) {\n  const OFFSET_ADJUST = 2;\n\n  // If inserting before adjust `x` by looking for element a few px to the right\n  // Otherwise adjust a few px to the left\n  // This is to allow a little tolerance by searching within the box, instead\n  // of getting a false negative by testing right on the border.\n  x = Math.max(x + (OFFSET_ADJUST * (insertBefore ? 1 : -1)), 0);\n\n  let node = textLayerElementFromPoint(x, y + OFFSET_ADJUST, pageNumber);\n  if (!node) {\n    return false;\n  }\n\n  // Now that node has been found inverse the adjustment for `x`.\n  // This is done to accomodate tolerance by cutting off on the outside of the\n  // text boundary, instead of missing a character by cutting off within.\n  x = x + (OFFSET_ADJUST * (insertBefore ? -1 : 1));\n\n  let svg = document.querySelector(`svg[data-pdf-annotate-page=\"${pageNumber}\"]`);\n  let left = scaleDown(svg, {left: node.getBoundingClientRect().left}).left - svg.getBoundingClientRect().left;\n  let temp = node.cloneNode(true);\n  let head = temp.innerHTML.split('');\n  let tail = [];\n\n  // Insert temp off screen\n  temp.style.position = 'absolute';\n  temp.style.top = '-10000px';\n  temp.style.left = '-10000px';\n  document.body.appendChild(temp);\n\n  while (head.length) {\n    // Don't insert within HTML tags\n    if (head[head.length - 1] === '>') {\n      while (head.length) {\n        tail.unshift(head.pop());\n        if (tail[0] === '<') {\n          break;\n        }\n      }\n    }\n\n    // Check if width of temp based on current head value satisfies x\n    temp.innerHTML = head.join('');\n    let width = scaleDown(svg, {width: temp.getBoundingClientRect().width}).width;\n    if (left + width <= x) {\n      break;\n    }\n    tail.unshift(head.pop());\n  }\n\n  // Update original node with new markup, including element to be inserted\n  node.innerHTML = head.join('') + el.outerHTML + tail.join('');\n  temp.parentNode.removeChild(temp);\n\n  return true;\n}\n\n/**\n * Get a text layer element at a given point on a page\n *\n * @param {Number} x The x coordinate of the point\n * @param {Number} y The y coordinate of the point\n * @param {Number} pageNumber The page to limit elements to\n * @return {Element} First text layer element found at the point\n */\nfunction textLayerElementFromPoint(x, y, pageNumber) {\n  let svg = document.querySelector(`svg[data-pdf-annotate-page=\"${pageNumber}\"]`);\n  let rect = svg.getBoundingClientRect();\n  y = scaleUp(svg, {y}).y + rect.top;\n  x = scaleUp(svg, {x}).x + rect.left;\n  return [...svg.parentNode.querySelectorAll(config.textClassQuery() + ' [data-canvas-width]')].filter((el) => {\n    return pointIntersectsRect(x, y, el.getBoundingClientRect());\n  })[0];\n}\n","import config from '../config';\nimport insertElementWithinElement from './insertElementWithinElement';\nimport { pointIntersectsRect, scaleUp } from '../UI/utils';\n\n/**\n * Insert an element at a point within the document.\n * This algorithm will try to insert between elements if possible.\n * It will however use `insertElementWithinElement` if it is more accurate.\n *\n * @param {Element} el The element to be inserted\n * @param {Number} x The x coordinate of the point\n * @param {Number} y The y coordinate of the point\n * @param {Number} pageNumber The page number to limit elements to\n * @return {Boolean} True if element was able to be inserted, otherwise false\n */\nexport default function insertElementWithinChildren(el, x, y, pageNumber) {\n  // Try and use most accurate method of inserting within an element\n  if (insertElementWithinElement(el, x, y, pageNumber, true)) {\n    return true;\n  }\n\n  // Fall back to inserting between elements\n  let svg = document.querySelector(`svg[data-pdf-annotate-page=\"${pageNumber}\"]`);\n  let rect = svg.getBoundingClientRect();\n  let nodes = [...svg.parentNode.querySelectorAll(config.textClassQuery() + ' > div')];\n\n  y = scaleUp(svg, {y}).y + rect.top;\n  x = scaleUp(svg, {x}).x + rect.left;\n\n  // Find the best node to insert before\n  for (let i = 0, l = nodes.length; i < l; i++) {\n    let n = nodes[i];\n    let r = n.getBoundingClientRect();\n    if (y <= r.top) {\n      n.parentNode.insertBefore(el, n);\n      return true;\n    }\n  }\n\n  // If all else fails try to append to the bottom\n  let textLayer = svg.parentNode.querySelector(config.textClassQuery());\n  if (textLayer) {\n    let textRect = textLayer.getBoundingClientRect();\n    if (pointIntersectsRect(x, y, textRect)) {\n      textLayer.appendChild(el);\n      return true;\n    }\n  }\n\n  return false;\n}\n","/**\n * Insert a comment into the DOM to be available by screen reader\n *\n * @param {Object} comment The comment to be inserted\n */\nexport default function insertScreenReaderComment(comment) {\n  if (!comment) {\n    return;\n  }\n\n  let list = document.querySelector(`#pdf-annotate-screenreader-${comment.annotation} ol`);\n  if (list) {\n    let item = document.createElement('li');\n    item.setAttribute('id', `pdf-annotate-screenreader-comment-${comment.uuid}`);\n    item.appendChild(document.createTextNode(`${comment.content}`));\n    list.appendChild(item);\n  }\n}\n","import PDFJSAnnotate from '../PDFJSAnnotate';\nimport insertScreenReaderComment from './insertScreenReaderComment';\n\n/**\n * Insert the comments into the DOM to be available by screen reader\n *\n * Example output:\n *   <div class=\"screenReaderOnly\">\n *    <div>Begin highlight 1</div>\n *    <ol aria-label=\"Comments\">\n *      <li>Foo</li>\n *      <li>Bar</li>\n *      <li>Baz</li>\n *      <li>Qux</li>\n *    </ol>\n *  </div>\n *  <div>Some highlighted text goes here...</div>\n *  <div class=\"screenReaderOnly\">End highlight 1</div>\n *\n * NOTE: `screenReaderOnly` is not a real class, just used for brevity\n *\n * @param {String} documentId The ID of the document\n * @param {String} annotationId The ID of the annotation\n * @param {Array} [comments] Optionally preloaded comments to be rendered\n * @return {Promise} Promise that once has comments, render them for screen reader\n */\nexport default function renderScreenReaderComments(documentId, annotationId, comments) {\n  let promise;\n\n  if (Array.isArray(comments)) {\n    promise = Promise.resolve(comments);\n  }\n  else {\n    promise = PDFJSAnnotate.getStoreAdapter().getComments(documentId, annotationId);\n  }\n\n  return promise.then((comments) => {\n    // Node needs to be found by querying DOM as it may have been inserted as innerHTML\n    // leaving `screenReaderNode` as an invalid reference (see `insertElementWithinElement`).\n    let node = document.getElementById(`pdf-annotate-screenreader-${annotationId}`);\n    if (node) {\n      let list = document.createElement('ol');\n      list.setAttribute('id', `pdf-annotate-screenreader-comment-list-${annotationId}`);\n      list.setAttribute('aria-label', 'Comments');\n      node.appendChild(list);\n      comments.forEach(insertScreenReaderComment);\n    }\n  });\n}\n","import createScreenReaderOnly from './createScreenReaderOnly';\nimport insertElementWithinChildren from './insertElementWithinChildren';\nimport insertElementWithinElement from './insertElementWithinElement';\nimport renderScreenReaderComments from './renderScreenReaderComments';\n\n// Annotation types that support comments\nconst COMMENT_TYPES = ['highlight', 'point', 'area', 'circle', 'emptycircle', 'fillcircle'];\n\n/**\n * Insert a hint into the DOM for screen readers for a specific annotation.\n *\n * @param {Object} annotation The annotation to insert a hint for\n * @param {Number} num The number of the annotation out of all annotations of the same type\n */\nexport default function insertScreenReaderHint(annotation, num = 0) {\n  switch (annotation.type) {\n    case 'highlight':\n    case 'strikeout':\n      let rects = annotation.rectangles;\n      let first = rects[0];\n      let last = rects[rects.length - 1];\n\n      insertElementWithinElement(\n        createScreenReaderOnly(`Begin ${annotation.type} annotation ${num}`, annotation.uuid),\n        first.x, first.y, annotation.page, true\n      );\n\n      insertElementWithinElement(\n        createScreenReaderOnly(`End ${annotation.type} annotation ${num}`, `${annotation.uuid}-end`),\n        last.x + last.width, last.y, annotation.page, false\n      );\n      break;\n\n    case 'textbox':\n    case 'point':\n      let text = annotation.type === 'textbox' ? ` (content: ${annotation.content})` : '';\n\n      insertElementWithinChildren(\n        createScreenReaderOnly(`${annotation.type} annotation ${num}${text}`, annotation.uuid),\n        annotation.x, annotation.y, annotation.page\n      );\n      break;\n\n    case 'drawing':\n    case 'area':\n      let x = typeof annotation.x !== 'undefined' ? annotation.x : annotation.lines[0][0];\n      let y = typeof annotation.y !== 'undefined' ? annotation.y : annotation.lines[0][1];\n\n      insertElementWithinChildren(\n        createScreenReaderOnly(`Unlabeled drawing`, annotation.uuid),\n        x, y, annotation.page\n      );\n      break;\n\n    case 'circle':\n    case 'fillcircle':\n    case 'emptycircle':\n      let x2 = typeof annotation.cx !== 'undefined' ? annotation.cx : annotation.lines[0][0];\n      let y2 = typeof annotation.cy !== 'undefined' ? annotation.cy : annotation.lines[0][1];\n\n      insertElementWithinChildren(\n        createScreenReaderOnly(`Unlabeled drawing`, annotation.uuid),\n        x2, y2, annotation.page\n      );\n      break;\n  }\n\n  // Include comments in screen reader hint\n  if (COMMENT_TYPES.includes(annotation.type)) {\n    renderScreenReaderComments(annotation.documentId, annotation.uuid);\n  }\n}\n","import renderScreenReaderHints from './renderScreenReaderHints';\nimport insertScreenReaderComment from './insertScreenReaderComment';\nimport renderScreenReaderComments from './renderScreenReaderComments';\nimport { addEventListener } from '../UI/event';\nimport PDFJSAnnotate from '../PDFJSAnnotate';\n\n/**\n * Initialize the event handlers for keeping screen reader hints synced with data\n */\nexport default function initEventHandlers() {\n  addEventListener('annotation:add', (documentId, pageNumber, annotation) => {\n    reorderAnnotationsByType(documentId, pageNumber, annotation.type);\n  });\n  addEventListener('annotation:edit', (documentId, annotationId, annotation) => {\n    reorderAnnotationsByType(documentId, annotation.page, annotation.type);\n  });\n  addEventListener('annotation:delete', removeAnnotation);\n  addEventListener('comment:add', insertComment);\n  addEventListener('comment:delete', removeComment);\n}\n\n/**\n * Reorder the annotation numbers by annotation type\n *\n * @param {String} documentId The ID of the document\n * @param {Number} pageNumber The page number of the annotations\n * @param {Strig} type The annotation type\n */\nfunction reorderAnnotationsByType(documentId, pageNumber, type) {\n  PDFJSAnnotate.getStoreAdapter().getAnnotations(documentId, pageNumber)\n    .then((annotations) => {\n      return annotations.annotations.filter((a) => {\n        return a.type === type;\n      });\n    })\n    .then((annotations) => {\n      annotations.forEach((a) => {\n        removeAnnotation(documentId, a.uuid);\n      });\n\n      return annotations;\n    })\n    .then(renderScreenReaderHints);\n}\n\n/**\n * Remove the screen reader hint for an annotation\n *\n * @param {String} documentId The ID of the document\n * @param {String} annotationId The Id of the annotation\n */\nfunction removeAnnotation(documentId, annotationId) {\n  removeElementById(`pdf-annotate-screenreader-${annotationId}`);\n  removeElementById(`pdf-annotate-screenreader-${annotationId}-end`);\n}\n\n/**\n * Insert a screen reader hint for a comment\n *\n * @param {String} documentId The ID of the document\n * @param {String} annotationId The ID of tha assocated annotation\n * @param {Object} comment The comment to insert a hint for\n */\nfunction insertComment(documentId, annotationId, comment) {\n  let list = document.querySelector(`pdf-annotate-screenreader-comment-list-${annotationId}`);\n  let promise;\n\n  if (!list) {\n    promise = renderScreenReaderComments(documentId, annotationId, []).then(() => {\n      list = document.querySelector(`pdf-annotate-screenreader-comment-list-${annotationId}`);\n      return true;\n    });\n  }\n  else {\n    promise = Promise.resolve(true);\n  }\n\n  promise.then(() => {\n    insertScreenReaderComment(comment);\n  });\n}\n\n/**\n * Remove a screen reader hint for a comment\n *\n * @param {String} documentId The ID of the document\n * @param {String} commentId The ID of the comment\n */\nfunction removeComment(documentId, commentId) {\n  removeElementById(`pdf-annotate-screenreader-comment-${commentId}`);\n}\n\n/**\n * Remove an element from the DOM by it's ID if it exists\n *\n * @param {String} elementId The ID of the element to be removed\n */\nfunction removeElementById(elementId) {\n  let el = document.getElementById(elementId);\n  if (el) {\n    el.parentNode.removeChild(el);\n  }\n}\n","import insertScreenReaderHint from './insertScreenReaderHint';\nimport initEventHandlers from './initEventHandlers';\n\n// TODO This is not the right place for this to live\ninitEventHandlers();\n\n/**\n * Insert hints into the DOM for screen readers.\n *\n * @param {Array} annotations The annotations that hints are inserted for\n */\nexport default function renderScreenReaderHints(annotations) {\n  annotations = Array.isArray(annotations) ? annotations : [];\n\n  // Insert hints for each type\n  Object.keys(SORT_TYPES).forEach((type) => {\n    let sortBy = SORT_TYPES[type];\n    annotations\n      .filter((a) => a.type === type)\n      .sort(sortBy)\n      .forEach((a, i) => insertScreenReaderHint(a, i + 1));\n  });\n}\n\n// Sort annotations first by y, then by x.\n// This allows hints to be injected in the order they appear,\n// which makes numbering them easier.\nfunction sortByPoint(a, b) {\n  if (a.y < b.y) {\n    return a.x - b.x;\n  }\n  else {\n    return 1;\n  }\n}\n\n// Sort annotation by it's first rectangle\nfunction sortByRectPoint(a, b) {\n  return sortByPoint(a.rectangles[0], b.rectangles[0]);\n}\n\n// Sort annotation by it's first line\nfunction sortByLinePoint(a, b) {\n  let lineA = a.lines[0];\n  let lineB = b.lines[0];\n  return sortByPoint(\n    {x: lineA[0], y: lineA[1]},\n    {x: lineB[0], y: lineB[1]}\n  );\n}\n\n// Arrange supported types and associated sort methods\nconst SORT_TYPES = {\n  'highlight': sortByRectPoint,\n  'strikeout': sortByRectPoint,\n  'drawing': sortByLinePoint,\n  'textbox': sortByPoint,\n  'point': sortByPoint,\n  'area': sortByPoint\n};\n\n","import PDFJSAnnotate from \"../PDFJSAnnotate\";\nimport config from \"../config\";\nimport renderScreenReaderHints from \"../a11y/renderScreenReaderHints\";\n\n// Template for creating a new page\nconst PAGE_TEMPLATE =\n  `\n  <div style=\"visibility: hidden;\" class=\"page\" data-loaded=\"false\">\n    <div class=\"canvasWrapper\">\n      <canvas></canvas>\n    </div>\n    <div class=\"` +\n  config.textLayerName +\n  `\"></div>\n    <svg class=\"` +\n  config.annotationLayerName +\n  `\"></svg>\n  </div>\n`;\n\n/**\n * Create a new page to be appended to the DOM.\n *\n * @param {Number} pageNumber The page number that is being created\n * @return {HTMLElement}\n */\nexport function createPage(pageNumber) {\n  let temp = document.createElement(\"div\");\n  temp.innerHTML = PAGE_TEMPLATE;\n\n  let page = temp.children[0];\n  let canvas = page.querySelector(\"canvas\");\n\n  page.setAttribute(\"id\", `pageContainer${pageNumber}`);\n  page.setAttribute(\"data-page-number\", pageNumber);\n\n  canvas.mozOpaque = true;\n  canvas.setAttribute(\"id\", `page${pageNumber}`);\n\n  return page;\n}\n\n/**\n * Render a page that has already been created.\n *\n * @param {Number} pageNumber The page number to be rendered\n * @param {Object} renderOptions The options for rendering\n * @return {Promise} Settled once rendering has completed\n *  A settled Promise will be either:\n *    - fulfilled: [pdfPage, annotations]\n *    - rejected: Error\n */\nexport function renderPage(pageNumber, renderOptions) {\n  let { documentId, pdfDocument, scale, rotate } = renderOptions;\n\n  const eventBus = new pdfjsViewer.EventBus();\n\n  // Load the page and annotations\n  return Promise.all([\n    pdfDocument.getPage(pageNumber),\n    PDFJSAnnotate.getAnnotations(documentId, pageNumber),\n  ]).then(([pdfPage, annotations]) => {\n    let page = document.getElementById(`pageContainer${pageNumber}`);\n    let svg = page.querySelector(config.annotationClassQuery());\n    let canvas = page.querySelector(\".canvasWrapper canvas\");\n    let canvasContext = canvas.getContext(\"2d\", { alpha: false });\n    let totalRotation = (rotate + pdfPage.rotate) % 360;\n    let viewport = pdfPage.getViewport({\n      scale: scale,\n      rotation: totalRotation,\n    });\n    let transform = scalePage(pageNumber, viewport, canvasContext);\n\n    // Render the page\n    return Promise.all([\n      pdfPage.render({ canvasContext, viewport, transform }).promise,\n      PDFJSAnnotate.render(svg, viewport, annotations),\n    ])\n      .then(() => {\n        // Text content is needed for a11y, but is also necessary for creating\n        // highlight and strikeout annotations which require selecting text.\n        return pdfPage\n          .getTextContent({ normalizeWhitespace: true })\n          .then((textContent) => {\n            return new Promise((resolve, reject) => {\n              // Render text layer for a11y of text content\n              // let textLayer = page.querySelector(config.textClassQuery());\n              // let textLayerFactory = new pdfjsViewer.DefaultTextLayerFactory();\n              // let textLayerBuilder = textLayerFactory.createTextLayerBuilder(\n              //   textLayer,\n              //   pageNumber - 1,\n              //   viewport,\n              //   false,\n              //   eventBus\n              // );\n              // textLayerBuilder.setTextContent(textContent);\n              // textLayerBuilder.render();\n\n              // Enable a11y for annotations\n              // Timeout is needed to wait for `textLayerBuilder.render`\n              setTimeout(() => {\n                try {\n                  renderScreenReaderHints(annotations.annotations);\n                  resolve();\n                } catch (e) {\n                  reject(e);\n                }\n              });\n            });\n          });\n      })\n      .then(() => {\n        // Indicate that the page was loaded\n        page.setAttribute(\"data-loaded\", \"true\");\n\n        return [pdfPage, annotations];\n      });\n  });\n}\n\n/**\n * Scale the elements of a page.\n *\n * @param {Number} pageNumber The page number to be scaled\n * @param {Object} viewport The viewport of the PDF page (see pdfPage.getViewport(scale, rotate))\n * @param {Object} context The canvas context that the PDF page is rendered to\n * @return {Array} The transform data for rendering the PDF page\n */\nfunction scalePage(pageNumber, viewport, context) {\n  let page = document.getElementById(`pageContainer${pageNumber}`);\n  let canvas = page.querySelector(\".canvasWrapper canvas\");\n  let svg = page.querySelector(config.annotationClassQuery());\n  let wrapper = page.querySelector(\".canvasWrapper\");\n  let textLayer = page.querySelector(config.textClassQuery());\n  let outputScale = getOutputScale(context);\n  let transform = !outputScale.scaled\n    ? null\n    : [outputScale.sx, 0, 0, outputScale.sy, 0, 0];\n  let sfx = approximateFraction(outputScale.sx);\n  let sfy = approximateFraction(outputScale.sy);\n\n  // Adjust width/height for scale\n  page.style.visibility = \"\";\n  canvas.width = roundToDivide(viewport.width * outputScale.sx, sfx[0]);\n  canvas.height = roundToDivide(viewport.height * outputScale.sy, sfy[0]);\n  canvas.style.width = roundToDivide(viewport.width, sfx[1]) + \"px\";\n  canvas.style.height = roundToDivide(viewport.height, sfx[1]) + \"px\";\n  svg.setAttribute(\"width\", viewport.width);\n  svg.setAttribute(\"height\", viewport.height);\n  svg.style.width = `${viewport.width}px`;\n  svg.style.height = `${viewport.height}px`;\n  page.style.width = `${viewport.width}px`;\n  page.style.height = `${viewport.height}px`;\n  wrapper.style.width = `${viewport.width}px`;\n  wrapper.style.height = `${viewport.height}px`;\n  textLayer.style.width = `${viewport.width}px`;\n  textLayer.style.height = `${viewport.height}px`;\n\n  return transform;\n}\n\n/**\n * Approximates a float number as a fraction using Farey sequence (max order of 8).\n *\n * @param {Number} x Positive float number\n * @return {Array} Estimated fraction: the first array item is a numerator,\n *                 the second one is a denominator.\n */\nfunction approximateFraction(x) {\n  // Fast path for int numbers or their inversions.\n  if (Math.floor(x) === x) {\n    return [x, 1];\n  }\n\n  const xinv = 1 / x;\n  const limit = 8;\n  if (xinv > limit) {\n    return [1, limit];\n  } else if (Math.floor(xinv) === xinv) {\n    return [1, xinv];\n  }\n\n  const x_ = x > 1 ? xinv : x;\n\n  // a/b and c/d are neighbours in Farey sequence.\n  let a = 0;\n  let b = 1;\n  let c = 1;\n  let d = 1;\n\n  // Limit search to order 8.\n  while (true) {\n    // Generating next term in sequence (order of q).\n    let p = a + c;\n    let q = b + d;\n    if (q > limit) {\n      break;\n    }\n    if (x_ <= p / q) {\n      c = p;\n      d = q;\n    } else {\n      a = p;\n      b = q;\n    }\n  }\n\n  // Select closest of neighbours to x.\n  if (x_ - a / b < c / d - x_) {\n    return x_ === x ? [a, b] : [b, a];\n  } else {\n    return x_ === x ? [c, d] : [d, c];\n  }\n}\n\nfunction getOutputScale(ctx) {\n  let devicePixelRatio = window.devicePixelRatio || 1;\n  let backingStoreRatio =\n    ctx.webkitBackingStorePixelRatio ||\n    ctx.mozBackingStorePixelRatio ||\n    ctx.msBackingStorePixelRatio ||\n    ctx.oBackingStorePixelRatio ||\n    ctx.backingStorePixelRatio ||\n    1;\n  let pixelRatio = devicePixelRatio / backingStoreRatio;\n  return {\n    sx: pixelRatio,\n    sy: pixelRatio,\n    scaled: pixelRatio !== 1,\n  };\n}\n\nfunction roundToDivide(x, div) {\n  let r = x % div;\n  return r === 0 ? x : Math.round(x - r + div);\n}\n","import { addEventListener, removeEventListener, fireEvent } from \"./event\";\nimport { disableEdit, enableEdit } from \"./edit\";\nimport { disablePen, enablePen, setPen } from \"./pen\";\nimport { disableArrow, enableArrow, setArrow } from \"./arrow\";\nimport { disableEraser, enableEraser } from \"./eraser\";\nimport { disablePoint, enablePoint } from \"./point\";\nimport { disableRect, enableRect } from \"./rect\";\nimport {\n  disableSignatureBlock,\n  enableSignatureBlock,\n  setSignatureBlock,\n  addSignatureBlock,\n} from \"./signatureBlock\";\nimport { disableText, enableText, setText } from \"./text\";\nimport { createPage, renderPage } from \"./page\";\n\nexport default {\n  addEventListener,\n  removeEventListener,\n  fireEvent,\n\n  disableEdit,\n  enableEdit,\n\n  disablePen,\n  enablePen,\n  setPen,\n\n  disablePoint,\n  enablePoint,\n\n  disableRect,\n  enableRect,\n\n  disableSignatureBlock,\n  enableSignatureBlock,\n  setSignatureBlock,\n  addSignatureBlock,\n\n  disableArrow,\n  enableArrow,\n  setArrow,\n\n  disableEraser,\n  enableEraser,\n\n  disableText,\n  enableText,\n  setText,\n\n  createPage,\n  renderPage,\n};\n","import StoreAdapter from './adapter/StoreAdapter';\nimport LocalStoreAdapter from './adapter/LocalStoreAdapter';\nimport LocalUserStoreAdapter from './adapter/LocalUserStoreAdapter';\nimport render from './render';\nimport UI from './UI';\nimport config from './config';\nimport uuid from './utils/uuid';\nimport {\n  findAnnotationAtPoint,\n  findSVGContainer,\n  convertToScreenPoint\n} from './UI/utils';\n\nexport default {\n  findAnnotationAtPoint,\n  findSVGContainer,\n  convertToScreenPoint,\n\n  /**\n   * Abstract class that needs to be defined so PDFJSAnnotate\n   * knows how to communicate with your server.\n   */\n  StoreAdapter,\n\n  /**\n   * Implementation of StoreAdapter that stores annotation data to localStorage.\n   */\n  LocalStoreAdapter,\n\n  /**\n   * Implementation of StoreAdapter that stores annotation data to localStorage particular\n   * to a specific user\n   */\n  LocalUserStoreAdapter,\n\n  /**\n   * Abstract instance of StoreAdapter\n   */\n  __storeAdapter: new StoreAdapter(),\n\n  /**\n   * Getter for the underlying StoreAdapter property\n   *\n   * @return {StoreAdapter}\n   */\n  getStoreAdapter() {\n    return this.__storeAdapter;\n  },\n\n  /**\n   * Setter for the underlying StoreAdapter property\n   *\n   * @param {StoreAdapter} adapter The StoreAdapter implementation to be used.\n   */\n  setStoreAdapter(adapter) {\n    // TODO this throws an error when bundled\n    // if (!(adapter instanceof StoreAdapter)) {\n    //   throw new Error('adapter must be an instance of StoreAdapter');\n    // }\n\n    this.__storeAdapter = adapter;\n  },\n\n  /**\n   * UI is a helper for instrumenting UI interactions for creating,\n   * editing, and deleting annotations in the browser.\n   */\n  UI,\n\n  /**\n   * Render the annotations for a page in the PDF Document\n   *\n   * @param {SVGElement} svg The SVG element that annotations should be rendered to\n   * @param {PageViewport} viewport The PDFPage.getViewport data\n   * @param {Object} data The StoreAdapter.getAnnotations data\n   * @return {Promise}\n   */\n  render,\n\n  /**\n   * Convenience method for getting annotation data\n   *\n   * @alias StoreAdapter.getAnnotations\n   * @param {String} documentId The ID of the document\n   * @param {String} pageNumber The page number\n   * @return {Promise}\n   */\n  getAnnotations(documentId, pageNumber) {\n    return this.getStoreAdapter().getAnnotations(...arguments);\n  },\n\n  config,\n\n  uuid\n};\n","import { appendChild, transformChild } from './appendChild';\n\n/**\n * Render the response from PDFJSAnnotate.getStoreAdapter().getAnnotations to SVG\n *\n * @param {SVGElement} svg The SVG element to render the annotations to\n * @param {Object} viewport The page viewport data\n * @param {Object} data The response from PDFJSAnnotate.getStoreAdapter().getAnnotations\n * @return {Promise} Settled once rendering has completed\n *  A settled Promise will be either:\n *    - fulfilled: SVGElement\n *    - rejected: Error\n */\nexport default function render(svg, viewport, data) {\n  return new Promise((resolve, reject) => {\n    // Reset the content of the SVG\n    svg.setAttribute('data-pdf-annotate-container', true);\n    svg.setAttribute('data-pdf-annotate-viewport', JSON.stringify(viewport));\n    svg.removeAttribute('data-pdf-annotate-document');\n    svg.removeAttribute('data-pdf-annotate-page');\n\n    // If there's no data nothing can be done\n    if (!data) {\n      svg.innerHTML = '';\n      return resolve(svg);\n    }\n\n    svg.setAttribute('data-pdf-annotate-document', data.documentId);\n    svg.setAttribute('data-pdf-annotate-page', data.pageNumber);\n\n    // Make sure annotations is an array\n    if (!Array.isArray(data.annotations) || data.annotations.length === 0) {\n      return resolve(svg);\n    }\n\n    // Append or transform annotation to svg\n    data.annotations.forEach((a) => {\n      let node = svg.querySelector('[data-pdf-annotate-id=\"' + a.uuid + '\"]');\n      if (node) {\n        transformChild(svg, node, viewport);\n      }\n      else {\n        appendChild(svg, a, viewport);\n      }\n    });\n\n    resolve(svg);\n  });\n}\n","import PDFJSAnnotate from './src/PDFJSAnnotate';\n\nexport default PDFJSAnnotate;\n"],"sourceRoot":""}